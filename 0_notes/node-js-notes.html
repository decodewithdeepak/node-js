<!DOCTYPE html>
<html>
<head>
<title>node-js-notes.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}


h1 {
	color: #2e8b57; /* Sea Green - for main title */
}

h2 {
	color: #1e90ff; /* Dodger Blue - for major sections */
}

h3 {
	color: #ff6b35; /* Orange Red - for subsections */
}

h4 {
	color: #8a2be2; /* Blue Violet - for sub-subsections */
}

h1, h2, h3 {
	font-weight: bold;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="nodejs-master-notes-by-deepak-modi">Node.js Master Notes By Deepak Modi</h1>
<blockquote>
<p>Recommended YouTube Playlist: <a href="https://www.youtube.com/playlist?list=PLinedj3B30sDby4Al-i13hQJGQoRQDfPo">Master NodeJS by Piyush Garg</a></p>
</blockquote>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li>
<p><a href="#1-introduction-to-nodejs">Introduction to Node.js</a></p>
<ul>
<li><a href="#11-what-is-nodejs">1.1 What is Node.js?</a></li>
<li><a href="#12-nodejs-installation">1.2 Node.js Installation</a></li>
<li><a href="#13-how-nodejs-works">1.3 How Node.js Works?</a></li>
<li><a href="#14-hello-world-in-nodejs">1.4 Hello World in Node.js</a></li>
</ul>
</li>
<li>
<p><a href="#2-core-concepts">Core Concepts</a></p>
<ul>
<li><a href="#21-modules-in-nodejs">2.1 Modules in Node.js</a></li>
<li><a href="#22-file-handling-in-nodejs">2.2 File Handling in Node.js</a></li>
<li><a href="#23-building-http-server-in-nodejs">2.3 Building HTTP Server in Node.js</a></li>
<li><a href="#24-handling-urls">2.4 Handling URLs</a></li>
<li><a href="#25-http-methods">2.5 HTTP Methods</a></li>
<li><a href="#26-versioning-in-nodejs">2.6 Versioning in Node.js</a></li>
<li><a href="#27-nodejs-package-manager-npm">2.7 Node.js Package Manager (npm)</a></li>
</ul>
</li>
<li>
<p><a href="#3-expressjs-and-apis">Express.js and APIs</a></p>
<ul>
<li><a href="#31-getting-started-with-express">3.1 Getting Started with Express</a></li>
<li><a href="#32-what-is-restful-api">3.2 What is RESTful API?</a></li>
<li><a href="#33-building-rest-apis-with-nodejs--express">3.3 Building REST APIs with Node.js + Express</a></li>
<li><a href="#34-express-middleware">3.4 Express Middleware</a></li>
<li><a href="#35-http-status-codes">3.5 HTTP Status Codes</a></li>
<li><a href="#36-http-headers-in-apis">3.6 HTTP Headers in APIs</a></li>
<li><a href="#37-introduction-to-postman">3.7 Introduction to POSTMAN</a></li>
</ul>
</li>
<li>
<p><a href="#4-database-integration">Database Integration</a></p>
<ul>
<li><a href="#41-introduction-to-mongodb">4.1 Introduction to MongoDB</a></li>
<li><a href="#42-connecting-nodejs-with-mongodb-mongoose--express">4.2 Connecting Node.js with MongoDB (Mongoose + Express)</a></li>
<li><a href="#43-mvc-pattern-in-nodejs">4.3 MVC Pattern in Node.js</a></li>
</ul>
</li>
<li>
<p><a href="#5-authentication-and-authorization">Authentication and Authorization</a></p>
<ul>
<li><a href="#51-authentication-methods">5.1 Authentication Methods</a></li>
<li><a href="#52-session-based-authentication">5.2 Session-based Authentication</a></li>
<li><a href="#53-jwt-json-web-tokens">5.3 JWT (JSON Web Tokens)</a></li>
<li><a href="#54-oauth-20-integration">5.4 OAuth 2.0 Integration</a></li>
<li><a href="#55-authorization-and-role-based-access-control">5.5 Authorization and Role-based Access Control</a></li>
</ul>
</li>
<li>
<p><a href="#6-projects-and-applications">Projects and Applications</a></p>
<ul>
<li><a href="#61-url-shortener-nodejs--mongodb">6.1 URL Shortener (Node.js + MongoDB)</a></li>
<li><a href="#62-discord-bot-in-nodejs">6.2 Discord Bot in Node.js</a></li>
<li><a href="#63-file-uploads-with-multer">6.3 File Uploads with Multer</a></li>
<li><a href="#64-blog-application-nodejs-mongodb-ejs">6.4 Blog Application (Node.js, MongoDB, EJS)</a></li>
</ul>
</li>
<li>
<p><a href="#7-deployment--performance">Deployment &amp; Performance</a></p>
<ul>
<li><a href="#71-vercel-deployment">7.1 Vercel Deployment</a></li>
<li><a href="#71-aws-deployment">7.2 AWS Deployment</a></li>
<li><a href="#73-serverless-framework--aws-lambda">7.3 Serverless Framework + AWS Lambda</a></li>
<li><a href="#74-scaling-nodejs-with-cluster">7.4 Scaling Node.js with Cluster</a></li>
<li><a href="#75-nginx-setup-serve-static-content-ssl-with-letsencrypt">7.5 NGINX (Setup, Serve Static Content, SSL with LetsEncrypt)</a></li>
</ul>
</li>
<li>
<p><a href="#8-real-time-and-streams">Real-time and Streams</a></p>
<ul>
<li><a href="#81-websocket-with-socketio">8.1 WebSocket with Socket.IO</a></li>
<li><a href="#82-nodejs-streams">8.2 Node.js Streams</a></li>
</ul>
</li>
<li>
<p><a href="#9-graphql-with-nodejs">GraphQL with Node.js</a></p>
<ul>
<li><a href="#91-graphql-crash-course">9.1 GraphQL Crash Course</a></li>
<li><a href="#92-setting-up-graphql-server">9.2 Setting up GraphQL Server</a></li>
<li><a href="#93-prisma--postgresql-setup">9.3 Prisma + PostgreSQL Setup</a></li>
<li><a href="#94-refactoring-graphql-code">9.4 Refactoring GraphQL Code</a></li>
<li><a href="#95-authentication--jwt-in-graphql">9.5 Authentication + JWT in GraphQL</a></li>
</ul>
</li>
</ol>
<hr>
<h2 id="1-introduction-to-nodejs">1. Introduction to Node.js</h2>
<h3 id="11-what-is-nodejs">1.1 What is Node.js?</h3>
<p>Node.js is an open-source, cross-platform JavaScript runtime environment that allows you to run JavaScript code outside the browser. Created by Ryan Dahl in 2009. Built on Google Chrome's V8 JavaScript engine, Node.js enables developers to build scalable, high-performance backend applications using JavaScript.</p>
<blockquote>
<p>Example: Backend of Netflix, LinkedIn, PayPal , Uber uses Node.js!</p>
</blockquote>
<ul>
<li><strong>Key Point:</strong> Node.js is not a programming language or a framework—it's a runtime environment for executing JavaScript on the server side.</li>
</ul>
<h4 id="why-use-nodejs">Why use Node.js?</h4>
<ul>
<li><strong>Non-blocking I/O:</strong> Handles many connections at once without waiting for operations like file or network access to finish.</li>
<li><strong>Single Language Stack:</strong> Use JavaScript for both frontend and backend, making full-stack development easier.</li>
<li><strong>Fast and Efficient:</strong> Powered by the V8 engine, Node.js is known for its speed.</li>
<li><strong>Large Ecosystem:</strong> npm (Node Package Manager) offers thousands of reusable packages.</li>
<li><strong>Community Support:</strong> Huge, active community and lots of learning resources.</li>
</ul>
<p><strong>Comparison Example:</strong></p>
<ul>
<li>Traditional backend (e.g., PHP, Java): Each request may create a new thread, which is resource-intensive.</li>
<li>Node.js: Uses a single-threaded event loop to handle many requests efficiently.</li>
</ul>
<h4 id="nodejs-in-modern-web-development">Node.js in Modern Web Development</h4>
<p>Node.js is used for:</p>
<ul>
<li>REST APIs</li>
<li>Real-time chat apps (e.g., WhatsApp clones)</li>
<li>Streaming services (e.g., Netflix)</li>
<li>IoT applications</li>
<li>Command-line tools</li>
</ul>
<p><strong>Real-World Example:</strong>
Netflix, PayPal, LinkedIn, and Uber use Node.js for parts of their backend systems.</p>
<h3 id="12-nodejs-installation">1.2 Node.js Installation</h3>
<h4 id="installing-nodejs">Installing Node.js</h4>
<ul>
<li><strong>Windows/Mac/Linux:</strong> Download from <a href="https://nodejs.org/">nodejs.org</a>. Installer includes npm.</li>
<li><strong>Check installation:</strong></li>
</ul>
<pre class="hljs"><code><div>node -v
npm -v
</div></code></pre>
<h4 id="using-repl-read-eval-print-loop">Using REPL (Read-Eval-Print Loop)</h4>
<p>REPL lets you run JavaScript code interactively in the terminal:</p>
<pre class="hljs"><code><div>node
&gt; 2 + 2
4
&gt; .<span class="hljs-built_in">exit</span>
</div></code></pre>
<h4 id="running-scripts">Running Scripts</h4>
<p>Save your code in a <code>.js</code> file and run:</p>
<pre class="hljs"><code><div>node hello.js
</div></code></pre>
<h4 id="using-nodemon-for-development">Using nodemon for Development</h4>
<p><code>nodemon</code> automatically restarts your app when files change.</p>
<pre class="hljs"><code><div>npm install -g nodemon
nodemon app.js
</div></code></pre>
<h3 id="13-how-nodejs-works">1.3 How Node.js Works?</h3>
<p>Node.js operates on an event-driven, non-blocking I/O model that makes it lightweight and efficient for building scalable network applications.
The core of Node.js is built around the event loop, which allows Node.js to handle multiple requests without creating new threads for each.</p>
<p><img src="https://d2ms8rpfqc4h24.cloudfront.net/working_flow_of_node_7610f28abc.jpg" alt="Node.js Architecture"></p>
<h4 id="the-event-loop-architecture">The Event Loop Architecture</h4>
<p>The event loop is what allows Node.js to perform non-blocking I/O operations despite JavaScript being single-threaded. When Node.js performs an I/O operation, like reading from the network or accessing a database, instead of blocking and waiting for the operation to complete, Node.js will resume the operation when the response comes back.</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Example demonstrating non-blocking behavior</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Start'</span>);

setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Timeout callback'</span>);
}, <span class="hljs-number">0</span>);

setImmediate(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Immediate callback'</span>);
});

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'End'</span>);

<span class="hljs-comment">// Output: Start, End, Immediate callback, Timeout callback</span>
</div></code></pre>
<h4 id="v8-javascript-engine">V8 JavaScript Engine</h4>
<p>Node.js is built on Google Chrome's V8 JavaScript engine, which compiles JavaScript directly to native machine code instead of interpreting it or executing it as bytecode. This makes Node.js applications incredibly fast and efficient.</p>
<h4 id="libuv-library">libuv Library</h4>
<p>Under the hood, Node.js uses libuv, a multi-platform C library that provides support for asynchronous I/O based on event loops. It handles file system operations, DNS lookup, network operations, and more.</p>
<h3 id="14-hello-world-in-nodejs">1.4 Hello World in Node.js</h3>
<p>Creating your first Node.js application is straightforward and demonstrates the fundamental difference between server-side JavaScript and browser JavaScript. This simple example shows how to execute JavaScript code outside the browser environment.</p>
<pre class="hljs"><code><div><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Hello Node!'</span>);

<span class="hljs-comment">// console.log(window); // Error in Node.js environment but works in browser</span>
<span class="hljs-comment">// console.log(alert("Hey there!")); // Error in Node.js environment but works in browser</span>
</div></code></pre>
<blockquote>
<p>Note:- Window objects, ui elements, and other browser-specific features are not available in Node.js.</p>
</blockquote>
<p>This example demonstrates a key difference between Node.js and browser JavaScript:</p>
<ul>
<li>Node.js has no access to browser-specific objects like <code>window</code> or <code>document</code></li>
<li>Browser functions like <code>alert()</code> don't exist in Node.js</li>
<li>Node.js includes server-specific features not available in browsers</li>
</ul>
<p>To run this example, save it as <code>hello.js</code> and execute:</p>
<pre class="hljs"><code><div>node hello.js
</div></code></pre>
<p>This will display &quot;Hello Node!&quot; in your terminal, demonstrating that Node.js is correctly executing JavaScript code outside the browser environment.</p>
<h2 id="2-core-concepts">2. Core Concepts</h2>
<h3 id="21-modules-in-nodejs">2.1 Modules in Node.js</h3>
<p>Modules are the building blocks of Node.js applications. They allow you to organize your code into separate files and reuse functionality across different parts of your application. Node.js supports both CommonJS and ES modules.</p>
<h4 id="commonjs-modules-default">CommonJS Modules (Default)</h4>
<p>CommonJS is the traditional module system in Node.js, using <code>require()</code> and <code>module.exports</code>.</p>
<pre class="hljs"><code><div><span class="hljs-comment">// math.js</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b</span>) </span>{
	<span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subtract</span>(<span class="hljs-params">a, b</span>) </span>{
	<span class="hljs-keyword">return</span> a - b;
}
<span class="hljs-built_in">module</span>.exports = { add, subtract };

<span class="hljs-comment">// app.js</span>
<span class="hljs-keyword">const</span> { add, subtract } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./math'</span>);
<span class="hljs-built_in">console</span>.log(add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 8</span>
<span class="hljs-built_in">console</span>.log(subtract(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 2</span>
</div></code></pre>
<h4 id="es-modules-modern">ES Modules (Modern)</h4>
<p>ES Modules (ECMAScript Modules) use <code>import</code> and <code>export</code> statements. To use ES modules, add <code>&quot;type&quot;: &quot;module&quot;</code> to your <code>package.json</code> or use <code>.mjs</code> file extension.</p>
<pre class="hljs"><code><div><span class="hljs-comment">// math.mjs (or math.js with "type": "module")</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b</span>) </span>{
	<span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subtract</span>(<span class="hljs-params">a, b</span>) </span>{
	<span class="hljs-keyword">return</span> a - b;
}

<span class="hljs-comment">// app.mjs (or app.js with "type": "module")</span>
<span class="hljs-keyword">import</span> { add, subtract } <span class="hljs-keyword">from</span> <span class="hljs-string">'./math.mjs'</span>;
<span class="hljs-built_in">console</span>.log(add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 8</span>
<span class="hljs-built_in">console</span>.log(subtract(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 2</span>
</div></code></pre>
<h3 id="22-file-handling-in-nodejs">2.2 File Handling in Node.js</h3>
<p>File handling is crucial for many Node.js applications. The <code>fs</code> module provides both synchronous and asynchronous methods for file operations. While synchronous methods block the event loop, asynchronous methods allow other operations to continue while waiting for file I/O to complete.</p>
<h4 id="synchronous-vs-asynchronous-operations">Synchronous vs Asynchronous Operations</h4>
<ul>
<li><strong>Sync (Blocking):</strong> Synchronous file operations block the event loop until completion, which can lead to performance issues in production applications.</li>
<li><strong>Async (Non-blocking):</strong> Asynchronous file operations allow the event loop to continue running while waiting for the operation to complete, improving scalability and responsiveness.</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// Synchronous (Blocking) - blocks the event loop</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'1'</span>);
<span class="hljs-keyword">const</span> result = fs.readFileSync(<span class="hljs-string">'./contacts.txt'</span>, <span class="hljs-string">'utf8'</span>);
<span class="hljs-built_in">console</span>.log(result);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'2'</span>);
<span class="hljs-comment">// Output: 1, [file contents], 2</span>

<span class="hljs-comment">// Asynchronous (Non-blocking) - doesn't block the event loop</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'1'</span>);
fs.readFile(<span class="hljs-string">'./contacts.txt'</span>, <span class="hljs-string">'utf8'</span>, (err, result) =&gt; {
	<span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
	<span class="hljs-built_in">console</span>.log(result);
});
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'2'</span>);
<span class="hljs-comment">// Output: 1, 2, [file contents]</span>
</div></code></pre>
<h4 id="file-writing-operations">File Writing Operations</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// Synchronous write</span>
fs.writeFileSync(<span class="hljs-string">'./file.txt'</span>, <span class="hljs-string">'Hello Write Sync'</span>);

<span class="hljs-comment">// Asynchronous write</span>
fs.writeFile(<span class="hljs-string">'./file.txt'</span>, <span class="hljs-string">'Hello Write Async'</span>, (err) =&gt; {
	<span class="hljs-keyword">if</span> (err) {
		<span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Error writing file:'</span>, err);
		<span class="hljs-keyword">return</span>;
	}
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'File written successfully'</span>);
});
</div></code></pre>
<blockquote>
<p>Note: Synchronous operations block the event loop, which can lead to performance issues in production applications. Use asynchronous methods for better scalability and responsiveness.</p>
</blockquote>
<h3 id="23-building-http-server-in-nodejs">2.3 Building HTTP Server in Node.js</h3>
<p>Creating HTTP servers is fundamental to Node.js web development. The built-in <code>http</code> module allows you to create servers that can handle HTTP requests and responses.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Request received: <span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.url}</span>`</span>);
	<span class="hljs-comment">// Set response headers</span>
	res.writeHead(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
	<span class="hljs-comment">// Send response</span>
	res.end(<span class="hljs-string">'Hello from Node.js Server!'</span>);
});

server.listen(<span class="hljs-number">3000</span>, () =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server running on http://localhost:3000'</span>);
});
</div></code></pre>
<h3 id="24-handling-urls">2.4 Handling URLs</h3>
<p>URL handling involves parsing request URLs and routing them to appropriate handlers.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-keyword">const</span> server = http.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
	<span class="hljs-keyword">const</span> parsedUrl = url.parse(req.url, <span class="hljs-literal">true</span>);
	<span class="hljs-keyword">const</span> path = parsedUrl.pathname;
	<span class="hljs-keyword">const</span> query = parsedUrl.query;

	<span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/'</span>) {
		res.end(<span class="hljs-string">'Home Page'</span>);
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/about'</span>) {
		res.end(<span class="hljs-string">`About Page - Hello <span class="hljs-subst">${query.name || <span class="hljs-string">'Guest'</span>}</span>`</span>);
	} <span class="hljs-keyword">else</span> {
		res.statusCode = <span class="hljs-number">404</span>;
		res.end(<span class="hljs-string">'Page Not Found'</span>);
	}
});

server.listen(<span class="hljs-number">3000</span>);
</div></code></pre>
<h3 id="25-http-methods">2.5 HTTP Methods</h3>
<p>HTTP methods define the type of action to be performed on a resource or data. They are essential for RESTful APIs and web applications.</p>
<ul>
<li><strong>GET</strong>: Retrieve data from the server (read-only).</li>
<li><strong>POST</strong>: Submit data to the server to create a resource.</li>
<li><strong>PUT</strong>: Update or replace existing data on the server completely.</li>
<li><strong>PATCH</strong>: Partially update existing data on the server.</li>
<li><strong>DELETE</strong>: Remove resource or data from the server.</li>
<li><strong>HEAD</strong>: Similar to GET, but only retrieves headers not the body.</li>
<li><strong>OPTIONS</strong>: Retrieve supported HTTP methods for a resource.</li>
</ul>
<h3 id="26-versioning-in-nodejs">2.6 Versioning in Node.js</h3>
<p>Node.js follows semantic versioning (SemVer) with the format <code>MAJOR.MINOR.PATCH</code>.</p>
<ul>
<li>Format: MAJOR.MINOR.PATCH (e.g., 1.2.3)</li>
<li><code>^1.2.3</code>: Compatible with 1.x.x</li>
<li><code>~1.2.3</code>: Compatible with 1.2.x</li>
</ul>
<table>
<thead>
<tr>
<th>Part</th>
<th>Meaning</th>
<th>Example change</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>MAJOR</strong></td>
<td>Breaking changes (incompatible API changes)</td>
<td><code>1.0.0 → 2.0.0</code></td>
</tr>
<tr>
<td><strong>MINOR</strong></td>
<td>New features, backward-compatible</td>
<td><code>1.2.0 → 1.3.0</code></td>
</tr>
<tr>
<td><strong>PATCH</strong></td>
<td>Bug fixes, backward-compatible</td>
<td><code>1.2.3 → 1.2.4</code></td>
</tr>
</tbody>
</table>
<p>Node.js releases:</p>
<ul>
<li><strong>LTS (Long Term Support)</strong>: Even-numbered versions (18, 20, 22) - recommended for production</li>
<li><strong>Current</strong>: Latest features with shorter support cycles</li>
</ul>
<h3 id="27-nodejs-package-manager-npm">2.7 Node.js Package Manager (npm)</h3>
<p>npm (Node Package Manager) is the default package manager for Node.js, used to install, update, and manage third-party packages and libraries. It provides a vast ecosystem of reusable code, making it easy to add functionality to your Node.js applications.</p>
<h4 id="installing-packages">Installing Packages</h4>
<p>To install a package, use the following command:</p>
<pre class="hljs"><code><div>npm install &lt;package-name&gt;
</div></code></pre>
<h4 id="creating-a-packagejson-file">Creating a package.json File</h4>
<p>To create a <code>package.json</code> file, which contains metadata about your project and its dependencies, run:</p>
<pre class="hljs"><code><div>npm init -y
</div></code></pre>
<h4 id="installing-updating-and-removing-packages">Installing, Updating, and Removing Packages</h4>
<p>You can manage packages using npm commands:</p>
<pre class="hljs"><code><div>npm install express
npm update express
npm uninstall express
</div></code></pre>
<h4 id="installing-specific-package-versions">Installing specific package versions</h4>
<p>To install a specific version of a package, you can specify the version number:</p>
<pre class="hljs"><code><div>npm install express@4.18.2
</div></code></pre>
<h4 id="using-npx-node-package-execute">Using npx (Node Package eXecute)</h4>
<p>npx is a package runner tool that comes with npm 5.2+ and allows you to execute packages without installing them globally. This is useful for running command-line tools or scripts locally without cluttering your global namespace.</p>
<pre class="hljs"><code><div>npx create-react-app my-app
</div></code></pre>
<h2 id="3-expressjs-and-apis">3. Express.js and APIs</h2>
<h3 id="31-getting-started-with-express">3.1 Getting Started with Express</h3>
<p>Express.js is a minimal and flexible Node.js web application framework that simplifies building web applications and APIs.</p>
<h4 id="problem-with-vanilla-nodejs">Problem with Vanilla Node.js</h4>
<p>Vanilla Node.js requires a lot of boilerplate code for routing, middleware, and handling requests/responses. Express.js abstracts these complexities and simplifies the process of creating server-side applications with Node.js. There is no need to create the server from scratch, handle routing manually, or manage middleware.</p>
<h4 id="installation-and-basic-setup">Installation and Basic Setup</h4>
<pre class="hljs"><code><div>npm init -y
npm install express
</div></code></pre>
<h4 id="setting-up-a-web-server-in-expressjs">Setting Up a Web Server in Express.js</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = express();

app.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
	res.send(<span class="hljs-string">'Welcome to Express!'</span>);
});

app.listen(<span class="hljs-number">3000</span>, () =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server running on port 3000'</span>);
});
</div></code></pre>
<h3 id="32-what-is-restful-api">3.2 What is RESTful API?</h3>
<p>REST (Representational State Transfer) is an architectural style for designing networked applications. RESTful APIs use standard HTTP methods and are stateless, scalable, and simple to understand.</p>
<h4 id="key-principles-of-rest">Key Principles of REST</h4>
<ul>
<li><strong>Stateless</strong>: Each request contains all necessary information</li>
<li><strong>Client-Server Architecture</strong>: Separation of concerns</li>
<li><strong>Uniform Interface</strong>: Standard HTTP methods and resource identification</li>
<li><strong>Cacheable</strong>: Responses should define cacheability</li>
</ul>
<h3 id="33-building-rest-apis-with-nodejs--express">3.3 Building REST APIs with Node.js + Express</h3>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = express();

<span class="hljs-comment">// Middleware for parsing JSON</span>
app.use(express.json());
app.use(express.urlencoded({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> }));

<span class="hljs-comment">// Sample data</span>
<span class="hljs-keyword">let</span> users = [{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Deepak Modi'</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">'deepak@gmail.com'</span> }];

<span class="hljs-comment">// GET all users</span>
app.get(<span class="hljs-string">'/api/users'</span>, (req, res) =&gt; {
	res.json(users);
});

<span class="hljs-comment">// GET user by ID</span>
app.get(<span class="hljs-string">'/api/users/:id'</span>, (req, res) =&gt; {
	<span class="hljs-keyword">const</span> user = users.find(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.id === <span class="hljs-built_in">parseInt</span>(req.params.id));
	<span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'User not found'</span> });
	res.json(user);
});

<span class="hljs-comment">// POST create user</span>
app.post(<span class="hljs-string">'/api/users'</span>, (req, res) =&gt; {
	<span class="hljs-keyword">const</span> newUser = {
		<span class="hljs-attr">id</span>: users.length + <span class="hljs-number">1</span>,
		<span class="hljs-attr">name</span>: req.body.name,
		<span class="hljs-attr">email</span>: req.body.email,
	};
	users.push(newUser);
	res.status(<span class="hljs-number">201</span>).json(newUser);
});

<span class="hljs-comment">// PUT update user</span>
app.put(<span class="hljs-string">'/api/users/:id'</span>, (req, res) =&gt; {
	<span class="hljs-keyword">const</span> userIndex = users.findIndex(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.id === <span class="hljs-built_in">parseInt</span>(req.params.id));
	<span class="hljs-keyword">if</span> (userIndex === <span class="hljs-number">-1</span>)
		<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'User not found'</span> });

	users[userIndex] = { ...users[userIndex], ...req.body };
	res.json(users[userIndex]);
});

<span class="hljs-comment">// DELETE user</span>
app.delete(<span class="hljs-string">'/api/users/:id'</span>, (req, res) =&gt; {
	<span class="hljs-keyword">const</span> userIndex = users.findIndex(<span class="hljs-function">(<span class="hljs-params">u</span>) =&gt;</span> u.id === <span class="hljs-built_in">parseInt</span>(req.params.id));
	<span class="hljs-keyword">if</span> (userIndex === <span class="hljs-number">-1</span>)
		<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'User not found'</span> });

	users.splice(userIndex, <span class="hljs-number">1</span>);
	res.status(<span class="hljs-number">204</span>).send();
});

app.listen(<span class="hljs-number">3000</span>, () =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server running on port 3000'</span>);
});
</div></code></pre>
<h4 id="running-an-express-server">Running an Express Server</h4>
<ul>
<li>Install Express using <code>npm install express</code>.</li>
<li>Create a file named <code>index.js</code> and add the Express server code.</li>
<li>Add <code>&quot;start&quot;: &quot;node index.js&quot;</code> or <code>&quot;dev&quot;: &quot;nodemon index.js&quot;</code> to your <code>package.json</code> scripts section to easily run your server.</li>
<li>Run commands like <code>npm start</code> or <code>npm run dev</code> to start your Express server.</li>
<li>Use <code>nodemon</code> for automatic server restarts during development by installing it globally with <code>npm install -g nodemon</code> or locally with <code>npm install --save-dev nodemon</code> as a dev dependency in your project.</li>
</ul>
<h4 id="tools-for-testing-rest-apis">Tools for Testing REST APIs</h4>
<ul>
<li><strong>Postman:</strong> A popular tool for testing APIs with a user-friendly interface.</li>
<li><strong>cURL:</strong> A command-line tool for making HTTP requests.</li>
<li><strong>Insomnia:</strong> Another user-friendly API testing tool.</li>
</ul>
<h4 id="best-practices-for-designing-rest-apis">Best Practices for Designing REST APIs</h4>
<ul>
<li>Use meaningful resource names (nouns) in URIs.</li>
<li>Use appropriate HTTP methods for actions (GET for read, POST for create, PUT/PATCH for update, DELETE for delete).</li>
<li>Use status codes to indicate success or failure (e.g., 200 OK, 201 Created, 404 Not Found).</li>
<li>Use middleware for common tasks like authentication, logging, and error handling.</li>
</ul>
<h3 id="34-express-middleware">3.4 Express Middleware</h3>
<p>Middleware functions are functions that execute during the request-response cycle in Express.js. They can modify the request and response objects, end the request-response cycle, or call the next middleware function in the stack.</p>
<p>These functions run before the final request handler and can be used for tasks like logging, authentication, parsing request bodies, and error handling.</p>
<h4 id="types-of-middleware">Types of Middleware</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// Application-level middleware</span>
app.use(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.url}</span> - <span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString()}</span>`</span>);
	next();
});

<span class="hljs-comment">// Built-in middleware</span>
app.use(express.json());
app.use(express.static(<span class="hljs-string">'public'</span>));

<span class="hljs-comment">// Router-level middleware</span>
app.use(<span class="hljs-string">'/api'</span>, apiRouter);

<span class="hljs-comment">// Error-handling middleware</span>
app.use(<span class="hljs-function">(<span class="hljs-params">err, req, res, next</span>) =&gt;</span> {
	<span class="hljs-built_in">console</span>.error(err.stack);
	res.status(<span class="hljs-number">500</span>).send(<span class="hljs-string">'Something broke!'</span>);
});
</div></code></pre>
<h3 id="35-http-status-codes">3.5 HTTP Status Codes</h3>
<p>HTTP status codes indicate the result of an HTTP request. They are grouped into five categories:</p>
<ul>
<li><strong>1xx Informational</strong>: Request received, continuing process</li>
<li><strong>2xx Success</strong>: The request was successfully received, understood, and accepted</li>
<li><strong>3xx Redirection</strong>: Further action needs to be taken to complete the request</li>
<li><strong>4xx Client Error</strong>: The request contains bad syntax or cannot be fulfilled</li>
<li><strong>5xx Server Error</strong>: The server failed to fulfill a valid request</li>
</ul>
<h4 id="common-status-codes">Common Status Codes</h4>
<ul>
<li>
<p><strong>2xx Success</strong></p>
<ul>
<li>200 OK: Request successful</li>
<li>201 Created: Resource created successfully</li>
<li>204 No Content: Request successful, no content to return</li>
</ul>
</li>
<li>
<p><strong>4xx Client Error</strong></p>
<ul>
<li>400 Bad Request: Invalid request</li>
<li>401 Unauthorized: Authentication required</li>
<li>403 Forbidden: Access denied</li>
<li>404 Not Found: Resource not found</li>
</ul>
</li>
<li>
<p><strong>5xx Server Error</strong></p>
<ul>
<li>500 Internal Server Error: Server error</li>
<li>503 Service Unavailable: Server temporarily unavailable</li>
</ul>
</li>
</ul>
<blockquote>
<p>Always return a appropriate status code with the response to indicate the result of the request.</p>
</blockquote>
<h3 id="36-http-headers-in-apis">3.6 HTTP Headers in APIs</h3>
<p>HTTP headers provide additional information about the request or response. They are key-value pairs sent between the client and server, allowing for metadata exchange.</p>
<pre class="hljs"><code><div>app.get(<span class="hljs-string">'/api/users'</span>, (req, res) =&gt; {
	<span class="hljs-comment">// Set response headers</span>
	res.set({
		<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
		<span class="hljs-string">'X-Powered-By'</span>: <span class="hljs-string">'Node.js'</span>,
	});

	<span class="hljs-comment">// Access request headers</span>
	<span class="hljs-keyword">const</span> userAgent = req.get(<span class="hljs-string">'User-Agent'</span>);
	<span class="hljs-keyword">const</span> authorization = req.headers.authorization;

	res.json(users);
});
</div></code></pre>
<h4 id="common-built-in-http-headers">Common built-in HTTP Headers</h4>
<ul>
<li><strong>Content-Type</strong>: Indicates the media type of the resource (e.g., <code>application/json</code>, <code>text/html</code>).</li>
<li><strong>Authorization</strong>: Contains credentials for authenticating the client.</li>
<li><strong>Cache-Control</strong>: Directives for caching mechanisms in both requests and responses.</li>
<li><strong>User-Agent</strong>: Information about the client application making the request.</li>
</ul>
<h4 id="custom-headers">Custom Headers</h4>
<p>Custom headers can be added to requests and responses to provide additional context or metadata. They should follow the naming convention of <code>X-</code> prefix to avoid conflicts with standard headers.</p>
<pre class="hljs"><code><div>app.get(<span class="hljs-string">'/api/users'</span>, (req, res) =&gt; {
	res.set(<span class="hljs-string">'X-Custom-Header'</span>, <span class="hljs-string">'CustomValue'</span>);
	res.json(users);
});
</div></code></pre>
<h3 id="37-introduction-to-postman">3.7 Introduction to POSTMAN</h3>
<p>Postman is a popular API testing tool that allows you to test your REST APIs easily with a user-friendly interface.</p>
<h4 id="installing-postman">Installing Postman</h4>
<ul>
<li>Download Desktop app: <a href="https://www.postman.com/downloads/">Postman Desktop</a></li>
<li>Use Postman Web: <a href="https://www.postman.com/">Postman Web</a></li>
<li>Install VS Code extension: <a href="https://marketplace.visualstudio.com/items?itemName=postman.postman-for-vscode">Postman for VS Code</a></li>
</ul>
<h4 id="using-postman-for-api-testing">Using Postman for API Testing</h4>
<ol>
<li>
<p><strong>GET Request</strong>: Test retrieving data</p>
<ul>
<li>URL: <code>http://localhost:3000/api/users</code></li>
<li>Method: GET</li>
</ul>
</li>
<li>
<p><strong>POST Request</strong>: Test creating data</p>
<ul>
<li>URL: <code>http://localhost:3000/api/users</code></li>
<li>Method: POST</li>
<li>Body: <code>{ &quot;name&quot;: &quot;Ranjit Barnwal&quot;, &quot;email&quot;: &quot;ranjit@gmail.com&quot; }</code></li>
</ul>
</li>
<li>
<p><strong>PUT Request</strong>: Test updating data</p>
<ul>
<li>URL: <code>http://localhost:3000/api/users/1</code></li>
<li>Method: PUT</li>
<li>Body: <code>{ &quot;name&quot;: &quot;Krishna Agarwal&quot;, &quot;email&quot;: &quot;krishna@example.com&quot; }</code></li>
</ul>
</li>
<li>
<p><strong>DELETE Request</strong>: Test deleting data</p>
<ul>
<li>URL: <code>http://localhost:3000/api/users/1</code></li>
<li>Method: DELETE</li>
</ul>
</li>
</ol>
<h2 id="4-database-integration">4. Database Integration</h2>
<h3 id="41-introduction-to-mongodb">4.1 Introduction to MongoDB</h3>
<p>MongoDB is a popular NoSQL database that stores data in flexible, JSON-like documents. It's well-suited for Node.js applications due to its JavaScript-like syntax and scalability.</p>
<p>MongoDB uses the lightweight and flexible BSON (Binary JSON), an extension JSON, to maximize efficiency.</p>
<h4 id="why-mongodb-with-nodejs">Why MongoDB with Node.js?</h4>
<ul>
<li><strong>JSON-like Documents</strong>: Natural fit with JavaScript objects</li>
<li><strong>Flexible Schema</strong>: Easy to modify data structure</li>
<li><strong>Scalability</strong>: Handles large amounts of data efficiently</li>
<li><strong>Rich Query Language</strong>: Powerful querying capabilities</li>
</ul>
<h4 id="installation-and-setup-of-mongodb">Installation and Setup of MongoDB</h4>
<ul>
<li><strong>Windows/Mac/Linux</strong>: Download from <a href="https://www.mongodb.com/try/download/community">mongodb.com</a>.</li>
</ul>
<blockquote>
<p>For step-by-step installation, refer to this blog: <a href="https://deepakmodi.hashnode.dev/how-to-install-mongodb-with-mongosh-on-windows-manually">How to Install MongoDB on Windows</a></p>
</blockquote>
<h4 id="mongodb-concepts">MongoDB Concepts</h4>
<ul>
<li><strong>Database</strong>: Collection of collections</li>
<li><strong>Collection</strong>: Group of documents (similar to table in SQL)</li>
<li><strong>Document</strong>: Individual record (similar to row in SQL)</li>
<li><strong>Field</strong>: Key-value pair in document (similar to column in SQL)</li>
</ul>
<h3 id="42-connecting-nodejs-with-mongodb-mongoose--express">4.2 Connecting Node.js with MongoDB (Mongoose + Express)</h3>
<p>Mongoose is an Object Data Modeling (ODM) library for MongoDB and Node.js that provides schema validation, casting, and business logic hooks.</p>
<blockquote>
<p>For MongoDB (NoSQL), we have ODM (Object Data Modeling) library called Mongoose. And for SQL databases, we have ORM (Object Relational Mapping) libraries like Prisma and Drizzle.</p>
</blockquote>
<h4 id="installation-of-mongoose">Installation of Mongoose</h4>
<p>To use Mongoose, you need to install it in your Node.js project:</p>
<pre class="hljs"><code><div>npm install mongoose
</div></code></pre>
<h4 id="basic-connection">Basic Connection</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-comment">// Connect to MongoDB</span>
mongoose
	.connect(<span class="hljs-string">'mongodb://localhost:27017/myapp'</span>)
	.then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'MongoDB connected'</span>))
	.catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'MongoDB connection error:'</span>, err));
</div></code></pre>
<h4 id="defining-schemas-and-models">Defining Schemas and Models</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// User schema</span>
<span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> mongoose.Schema({
	<span class="hljs-attr">name</span>: {
		<span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
		<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
		<span class="hljs-attr">trim</span>: <span class="hljs-literal">true</span>,
	},
	<span class="hljs-attr">email</span>: {
		<span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
		<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
		<span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>,
		<span class="hljs-attr">lowercase</span>: <span class="hljs-literal">true</span>,
	},
	<span class="hljs-attr">age</span>: {
		<span class="hljs-attr">type</span>: <span class="hljs-built_in">Number</span>,
		<span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
		<span class="hljs-attr">max</span>: <span class="hljs-number">120</span>,
	},
	<span class="hljs-attr">createdAt</span>: {
		<span class="hljs-attr">type</span>: <span class="hljs-built_in">Date</span>,
		<span class="hljs-attr">default</span>: <span class="hljs-built_in">Date</span>.now,
	},
});

<span class="hljs-comment">// Create model</span>
<span class="hljs-keyword">const</span> User = mongoose.model(<span class="hljs-string">'User'</span>, userSchema);

<span class="hljs-built_in">module</span>.exports = User;
</div></code></pre>
<h4 id="crud-operations-with-mongoose">CRUD Operations with Mongoose</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> User = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./models/User'</span>);

<span class="hljs-comment">// Create user</span>
app.post(<span class="hljs-string">'/api/users'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> User(req.body); <span class="hljs-comment">// create user object</span>
		<span class="hljs-keyword">await</span> user.save(); <span class="hljs-comment">// save in database</span>
		res.status(<span class="hljs-number">201</span>).json(user);
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">400</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
});

<span class="hljs-comment">// Get all users</span>
app.get(<span class="hljs-string">'/api/users'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> User.find();
		res.json(users);
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
});

<span class="hljs-comment">// Get user by ID</span>
app.get(<span class="hljs-string">'/api/users/:id'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findById(req.params.id);
		<span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'User not found'</span> });
		res.json(user);
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
});

<span class="hljs-comment">// Update user</span>
app.put(<span class="hljs-string">'/api/users/:id'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findByIdAndUpdate(req.params.id, req.body, {
			<span class="hljs-attr">new</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">runValidators</span>: <span class="hljs-literal">true</span>,
		});
		<span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'User not found'</span> });
		res.json(user);
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">400</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
});

<span class="hljs-comment">// Delete user</span>
app.delete(<span class="hljs-string">'/api/users/:id'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findByIdAndDelete(req.params.id);
		<span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'User not found'</span> });
		res.status(<span class="hljs-number">204</span>).send();
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
});
</div></code></pre>
<h3 id="43-mvc-pattern-in-nodejs">4.3 MVC Pattern in Node.js</h3>
<p>MVC (Model-View-Controller) is an architectural pattern that separates application logic into three interconnected components.</p>
<h4 id="mvc-structure">MVC Structure</h4>
<p>A typical MVC structure in Node.js might look like this:</p>
<pre class="hljs"><code><div>project/
├── models/
│   └── User.js             →  Schema and model
├── views/
│   └── users.ejs           →  Templating engine (EJS, Pug, etc.)
│   └── index.html          →  Static HTML file
├── controllers/
│   └── userController.js   →  Business logic (CRUD)
├── routes/
│   └── userRoutes.js       →  API endpoints
└── app.js                  →  Main file (connect, setup)
</div></code></pre>
<h4 id="model-modelsuserjs">Model (models/User.js)</h4>
<p>The model handles data and database interactions.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> mongoose.Schema({
	<span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
	<span class="hljs-attr">email</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> },
	<span class="hljs-attr">age</span>: <span class="hljs-built_in">Number</span>,
});

<span class="hljs-built_in">module</span>.exports = mongoose.model(<span class="hljs-string">'User'</span>, userSchema);
</div></code></pre>
<h4 id="controller-controllersusercontrollerjs">Controller (controllers/userController.js)</h4>
<p>The controller contains the logic for handling requests and responses.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> User = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/User'</span>);

exports.getAllUsers = <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> User.find();
		res.json(users);
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
};

exports.createUser = <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> User(req.body);
		<span class="hljs-keyword">await</span> user.save();
		res.status(<span class="hljs-number">201</span>).json(user);
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">400</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
};

exports.getUserById = <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findById(req.params.id);
		<span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'User not found'</span> });
		res.json(user);
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
};
</div></code></pre>
<h4 id="view-viewsusersejs">View (views/users.ejs)</h4>
<p>The view is responsible for rendering the user interface. For web apps, you might use templating engines like EJS, Pug, or Handlebars. For REST APIs serving JSON to frontend frameworks like React/Next.js, views are typically handled on the frontend.</p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Users<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Users List<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">users.forEach</span>(<span class="hljs-attr">user</span> =&gt;</span> { %&gt;
			<span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">user.name</span> %&gt;</span> - <span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">user.email</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">%</span> }) %&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>
<h4 id="routes-routesuserroutesjs">Routes (routes/userRoutes.js)</h4>
<p>The routes define the endpoints and map them to controller functions.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> userController = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../controllers/userController'</span>);

<span class="hljs-keyword">const</span> router = express.Router();

router.get(<span class="hljs-string">'/'</span>, userController.getAllUsers);
router.post(<span class="hljs-string">'/'</span>, userController.createUser);
router.get(<span class="hljs-string">'/:id'</span>, userController.getUserById);

<span class="hljs-built_in">module</span>.exports = router;
</div></code></pre>
<h4 id="main-app-appjs">Main App (app.js)</h4>
<p>The entry point of the application sets up the server, connects to the database, and uses the routes.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> userRoutes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./routes/userRoutes'</span>);

<span class="hljs-keyword">const</span> app = express();

<span class="hljs-comment">// Middleware</span>
app.use(express.json());

<span class="hljs-comment">// Routes</span>
app.use(<span class="hljs-string">'/api/users'</span>, userRoutes);

<span class="hljs-comment">// Connect to MongoDB</span>
mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/myapp'</span>);

app.listen(<span class="hljs-number">3000</span>, () =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server running on port 3000'</span>);
});
</div></code></pre>
<p>This MVC structure provides better organization, maintainability, and separation of concerns in your Node.js applications.</p>
<h2 id="5-authentication-and-authorization">5. Authentication and Authorization</h2>
<p>Authentication and authorization are crucial security components in web applications. Authentication verifies user identity, while authorization determines what resources users can access based on their permissions.</p>
<h3 id="51-authentication-methods">5.1 Authentication Methods</h3>
<p>Authentication is the process of verifying who a user is. There are several methods to implement authentication in Node.js applications:</p>
<ul>
<li><strong>Password-based Authentication</strong>: Storing user credentials (username/email and password) securely in database.</li>
<li><strong>Session-based Authentication (Stateful)</strong>: Storing user information on the server and using cookies to maintain state.</li>
<li><strong>Token-based Authentication (Stateless)</strong>: Using tokens (like JWT) to authenticate users without maintaining server-side state.</li>
<li><strong>OAuth Authentication</strong>: Using third-party services (like Google, GitHub, Facebook) to authenticate users.</li>
</ul>
<h4 id="password-based-authentication">Password-based Authentication</h4>
<p>The most simple authentication method is by storing username/email and password securely in the database. Passwords should be hashed before storing them to enhance security.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> bcrypt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bcryptjs'</span>); <span class="hljs-comment">// hashing algorithm</span>
<span class="hljs-keyword">const</span> User = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/User'</span>);

<span class="hljs-comment">// Registration</span>
<span class="hljs-keyword">const</span> registerUser = <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">const</span> { username, email, password } = req.body;

	<span class="hljs-keyword">try</span> {
		<span class="hljs-comment">// Hash password</span>
		<span class="hljs-keyword">const</span> saltRounds = <span class="hljs-number">10</span>;
		<span class="hljs-keyword">const</span> hashedPassword = <span class="hljs-keyword">await</span> bcrypt.hash(password, saltRounds);

		<span class="hljs-comment">// Create user</span>
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> User({
			username,
			email,
			<span class="hljs-attr">password</span>: hashedPassword,
		});

		<span class="hljs-keyword">await</span> user.save();
		res.status(<span class="hljs-number">201</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'User registered successfully'</span> });
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">400</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
};

<span class="hljs-comment">// Login</span>
<span class="hljs-keyword">const</span> loginUser = <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">const</span> { email, password } = req.body;

	<span class="hljs-keyword">try</span> {
		<span class="hljs-comment">// Find user</span>
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findOne({ email });
		<span class="hljs-keyword">if</span> (!user) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">401</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'User not found'</span> });
		}

		<span class="hljs-comment">// Verify password</span>
		<span class="hljs-keyword">const</span> isPasswordValid = <span class="hljs-keyword">await</span> bcrypt.compare(password, user.password);
		<span class="hljs-keyword">if</span> (!isPasswordValid) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">401</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Wrong password'</span> });
		}

		res.status(<span class="hljs-number">200</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Login successful'</span>, <span class="hljs-attr">userId</span>: user._id });
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
};
</div></code></pre>
<h3 id="52-session-based-authentication">5.2 Session-based Authentication</h3>
<p>Session-based authentication stores user information on the server and uses cookies (session ID) to maintain state.</p>
<h4 id="installing-session-dependencies">Installing Session Dependencies</h4>
<pre class="hljs"><code><div>npm install express-session connect-mongo
</div></code></pre>
<h4 id="session-implementation">Session Implementation</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express-session'</span>);
<span class="hljs-keyword">const</span> MongoStore = <span class="hljs-built_in">require</span>(<span class="hljs-string">'connect-mongo'</span>);

<span class="hljs-comment">// Session configuration</span>
app.use(
	session({
		<span class="hljs-attr">secret</span>: process.env.SESSION_SECRET || <span class="hljs-string">'your-session-secret'</span>,
		<span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,
		<span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>,
		<span class="hljs-attr">store</span>: MongoStore.create({
			<span class="hljs-attr">mongoUrl</span>: <span class="hljs-string">'mongodb://localhost:27017/your-app'</span>,
		}),
		<span class="hljs-attr">cookie</span>: {
			<span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// Set to true in production with HTTPS</span>
			<span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">maxAge</span>: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 24 hours</span>
		},
	})
);

<span class="hljs-comment">// Login with sessions</span>
<span class="hljs-keyword">const</span> loginWithSession = <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">const</span> { email, password } = req.body;

	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findOne({ email });
		<span class="hljs-keyword">if</span> (!user || !(<span class="hljs-keyword">await</span> bcrypt.compare(password, user.password))) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">401</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Invalid credentials'</span> });
		}

		<span class="hljs-comment">// Store user info in session</span>
		req.session.userId = user._id;
		req.session.username = user.username;

		res.status(<span class="hljs-number">200</span>).json({
			<span class="hljs-attr">message</span>: <span class="hljs-string">'Login successful'</span>,
			<span class="hljs-attr">user</span>: { <span class="hljs-attr">id</span>: user._id, <span class="hljs-attr">username</span>: user.username, <span class="hljs-attr">email</span>: user.email },
		});
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
};

<span class="hljs-comment">// Session middleware for protecting routes</span>
<span class="hljs-keyword">const</span> requireAuth = <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
	<span class="hljs-keyword">if</span> (!req.session.userId) {
		<span class="hljs-keyword">return</span> res
			.status(<span class="hljs-number">401</span>)
			.json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Please log in to access this resource'</span> });
	}
	next();
};

<span class="hljs-comment">// Logout</span>
<span class="hljs-keyword">const</span> logout = <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
	req.session.destroy(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
		<span class="hljs-keyword">if</span> (err) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Could not log out'</span> });
		}
		res.clearCookie(<span class="hljs-string">'connect.sid'</span>); <span class="hljs-comment">// Clear session cookie</span>
		res.status(<span class="hljs-number">200</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Logged out successfully'</span> });
	});
};
</div></code></pre>
<h3 id="53-jwt-json-web-tokens">5.3 JWT (JSON Web Tokens)</h3>
<p>JWT is a stateless authentication method that encodes user information in a token. It's ideal for APIs and distributed systems.</p>
<h4 id="installing-jwt-dependencies">Installing JWT Dependencies</h4>
<pre class="hljs"><code><div>npm install jsonwebtoken
</div></code></pre>
<h4 id="jwt-implementation">JWT Implementation</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsonwebtoken'</span>);
<span class="hljs-keyword">const</span> JWT_SECRET = process.env.JWT_SECRET || <span class="hljs-string">'your-secret-key'</span>;

<span class="hljs-comment">// Generate JWT token</span>
<span class="hljs-keyword">const</span> generateToken = <span class="hljs-function">(<span class="hljs-params">userId</span>) =&gt;</span> {
	<span class="hljs-keyword">return</span> jwt.sign({ userId }, JWT_SECRET, { <span class="hljs-attr">expiresIn</span>: <span class="hljs-string">'7d'</span> });
};

<span class="hljs-comment">// Login with JWT</span>
<span class="hljs-keyword">const</span> loginWithJWT = <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">const</span> { email, password } = req.body;

	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findOne({ email });
		<span class="hljs-keyword">if</span> (!user || !(<span class="hljs-keyword">await</span> bcrypt.compare(password, user.password))) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">401</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Invalid credentials'</span> });
		}

		<span class="hljs-comment">// Generate token</span>
		<span class="hljs-keyword">const</span> token = generateToken(user._id);

		res.status(<span class="hljs-number">200</span>).json({
			<span class="hljs-attr">message</span>: <span class="hljs-string">'Login successful'</span>,
			token,
			<span class="hljs-attr">user</span>: { <span class="hljs-attr">id</span>: user._id, <span class="hljs-attr">username</span>: user.username, <span class="hljs-attr">email</span>: user.email },
		});
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
};

<span class="hljs-comment">// JWT Middleware for protecting routes</span>
<span class="hljs-keyword">const</span> authenticateToken = <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
	<span class="hljs-keyword">const</span> authHeader = req.headers[<span class="hljs-string">'authorization'</span>];
	<span class="hljs-keyword">const</span> token = authHeader &amp;&amp; authHeader.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">1</span>]; <span class="hljs-comment">// Bearer TOKEN</span>

	<span class="hljs-keyword">if</span> (!token) {
		<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">401</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Access token required'</span> });
	}

	jwt.verify(token, JWT_SECRET, (err, decoded) =&gt; {
		<span class="hljs-keyword">if</span> (err) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">403</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Invalid or expired token'</span> });
		}
		req.userId = decoded.userId;
		next();
	});
};

<span class="hljs-comment">// Protected route example</span>
app.get(<span class="hljs-string">'/api/profile'</span>, authenticateToken, <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findById(req.userId).select(<span class="hljs-string">'-password'</span>);
		res.json(user);
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
});
</div></code></pre>
<h3 id="54-oauth-20-integration">5.4 OAuth 2.0 Integration</h3>
<p>OAuth allows users to authenticate using third-party services like Google, GitHub, or Facebook.</p>
<h4 id="installing-oauth-dependencies">Installing OAuth Dependencies</h4>
<pre class="hljs"><code><div>npm install passport passport-google-oauth20 passport-local express-session
</div></code></pre>
<h4 id="google-oauth-example">Google OAuth Example</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);
<span class="hljs-keyword">const</span> GoogleStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-google-oauth20'</span>).Strategy;

<span class="hljs-comment">// Google OAuth configuration</span>
passport.use(
	<span class="hljs-keyword">new</span> GoogleStrategy(
		{
			<span class="hljs-attr">clientID</span>: process.env.GOOGLE_CLIENT_ID,
			<span class="hljs-attr">clientSecret</span>: process.env.GOOGLE_CLIENT_SECRET,
			<span class="hljs-attr">callbackURL</span>: <span class="hljs-string">'/auth/google/callback'</span>,
		},
		<span class="hljs-keyword">async</span> (accessToken, refreshToken, profile, done) =&gt; {
			<span class="hljs-keyword">try</span> {
				<span class="hljs-comment">// Check if user exists</span>
				<span class="hljs-keyword">let</span> user = <span class="hljs-keyword">await</span> User.findOne({ <span class="hljs-attr">googleId</span>: profile.id });

				<span class="hljs-keyword">if</span> (user) {
					<span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
				}

				<span class="hljs-comment">// Create new user</span>
				user = <span class="hljs-keyword">new</span> User({
					<span class="hljs-attr">googleId</span>: profile.id,
					<span class="hljs-attr">username</span>: profile.displayName,
					<span class="hljs-attr">email</span>: profile.emails[<span class="hljs-number">0</span>].value,
					<span class="hljs-attr">avatar</span>: profile.photos[<span class="hljs-number">0</span>].value,
				});

				<span class="hljs-keyword">await</span> user.save();
				<span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
			} <span class="hljs-keyword">catch</span> (error) {
				<span class="hljs-keyword">return</span> done(error, <span class="hljs-literal">null</span>);
			}
		}
	)
);

<span class="hljs-comment">// Serialize user for session</span>
passport.serializeUser(<span class="hljs-function">(<span class="hljs-params">user, done</span>) =&gt;</span> {
	done(<span class="hljs-literal">null</span>, user._id);
});

passport.deserializeUser(<span class="hljs-keyword">async</span> (id, done) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findById(id);
		done(<span class="hljs-literal">null</span>, user);
	} <span class="hljs-keyword">catch</span> (error) {
		done(error, <span class="hljs-literal">null</span>);
	}
});

<span class="hljs-comment">// OAuth routes</span>
app.get(
	<span class="hljs-string">'/auth/google'</span>,
	passport.authenticate(<span class="hljs-string">'google'</span>, { <span class="hljs-attr">scope</span>: [<span class="hljs-string">'profile'</span>, <span class="hljs-string">'email'</span>] })
);

app.get(
	<span class="hljs-string">'/auth/google/callback'</span>,
	passport.authenticate(<span class="hljs-string">'google'</span>, { <span class="hljs-attr">failureRedirect</span>: <span class="hljs-string">'/login'</span> }),
	(req, res) =&gt; {
		res.redirect(<span class="hljs-string">'/dashboard'</span>); <span class="hljs-comment">// Successful authentication</span>
	}
);
</div></code></pre>
<h3 id="55-authorization-and-role-based-access-control">5.5 Authorization and Role-based Access Control</h3>
<p>Authorization determines what authenticated users can access based on their roles and permissions.</p>
<h4 id="role-based-authorization">Role-based Authorization</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// User model with roles</span>
<span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> mongoose.Schema({
	<span class="hljs-attr">username</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
	<span class="hljs-attr">email</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> },
	<span class="hljs-attr">password</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
	<span class="hljs-attr">role</span>: {
		<span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
		<span class="hljs-attr">enum</span>: [<span class="hljs-string">'user'</span>, <span class="hljs-string">'admin'</span>, <span class="hljs-string">'moderator'</span>],
		<span class="hljs-attr">default</span>: <span class="hljs-string">'user'</span>,
	},
	<span class="hljs-attr">permissions</span>: [
		{
			<span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
			<span class="hljs-attr">enum</span>: [<span class="hljs-string">'read'</span>, <span class="hljs-string">'write'</span>, <span class="hljs-string">'delete'</span>, <span class="hljs-string">'manage_users'</span>],
		},
	],
});

<span class="hljs-comment">// Authorization middleware</span>
<span class="hljs-keyword">const</span> authorize = <span class="hljs-function">(<span class="hljs-params">roles = []</span>) =&gt;</span> {
	<span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
		<span class="hljs-keyword">if</span> (!req.user) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">401</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Authentication required'</span> });
		}

		<span class="hljs-keyword">if</span> (roles.length &amp;&amp; !roles.includes(req.user.role)) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">403</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Insufficient permissions'</span> });
		}

		next();
	};
};

<span class="hljs-comment">// Permission-based authorization</span>
<span class="hljs-keyword">const</span> checkPermission = <span class="hljs-function">(<span class="hljs-params">permission</span>) =&gt;</span> {
	<span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
		<span class="hljs-keyword">if</span> (!req.user) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">401</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Authentication required'</span> });
		}

		<span class="hljs-keyword">if</span> (!req.user.permissions.includes(permission)) {
			<span class="hljs-keyword">return</span> res
				.status(<span class="hljs-number">403</span>)
				.json({ <span class="hljs-attr">message</span>: <span class="hljs-string">`<span class="hljs-subst">${permission}</span> permission required`</span> });
		}

		next();
	};
};

<span class="hljs-comment">// Protected routes with role-based access</span>
app.get(
	<span class="hljs-string">'/api/admin/users'</span>,
	authenticateToken,
	authorize([<span class="hljs-string">'admin'</span>]),
	<span class="hljs-keyword">async</span> (req, res) =&gt; {
		<span class="hljs-keyword">try</span> {
			<span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> User.find().select(<span class="hljs-string">'-password'</span>);
			res.json(users);
		} <span class="hljs-keyword">catch</span> (error) {
			res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
		}
	}
);

app.delete(
	<span class="hljs-string">'/api/posts/:id'</span>,
	authenticateToken,
	checkPermission(<span class="hljs-string">'delete'</span>),
	<span class="hljs-keyword">async</span> (req, res) =&gt; {
		<span class="hljs-keyword">try</span> {
			<span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> Post.findByIdAndDelete(req.params.id);
			<span class="hljs-keyword">if</span> (!post) {
				<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Post not found'</span> });
			}
			res.status(<span class="hljs-number">204</span>).send();
		} <span class="hljs-keyword">catch</span> (error) {
			res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
		}
	}
);

<span class="hljs-comment">// Resource-based authorization (users can only edit their own posts)</span>
<span class="hljs-keyword">const</span> checkResourceOwnership = <span class="hljs-keyword">async</span> (req, res, next) =&gt; {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> Post.findById(req.params.id);
		<span class="hljs-keyword">if</span> (!post) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Post not found'</span> });
		}

		<span class="hljs-keyword">if</span> (post.author.toString() !== req.userId &amp;&amp; req.user.role !== <span class="hljs-string">'admin'</span>) {
			<span class="hljs-keyword">return</span> res.status(<span class="hljs-number">403</span>).json({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Access denied'</span> });
		}

		req.post = post;
		next();
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
};

app.put(
	<span class="hljs-string">'/api/posts/:id'</span>,
	authenticateToken,
	checkResourceOwnership,
	<span class="hljs-keyword">async</span> (req, res) =&gt; {
		<span class="hljs-keyword">try</span> {
			<span class="hljs-keyword">const</span> updatedPost = <span class="hljs-keyword">await</span> Post.findByIdAndUpdate(
				req.params.id,
				req.body,
				{ <span class="hljs-attr">new</span>: <span class="hljs-literal">true</span> }
			);
			res.json(updatedPost);
		} <span class="hljs-keyword">catch</span> (error) {
			res.status(<span class="hljs-number">400</span>).json({ <span class="hljs-attr">error</span>: error.message });
		}
	}
);
</div></code></pre>
<h2 id="6-projects-and-applications">6. Projects and Applications</h2>
<h3 id="61-url-shortener-nodejs--mongodb">6.1 URL Shortener (Node.js + MongoDB)</h3>
<p>A URL shortener is a simple web application that converts long URLs into shorter, more manageable links. It typically involves generating a unique identifier for each URL and storing the mapping in a database.</p>
<h4 id="features">Features</h4>
<ul>
<li>Shorten a long URL</li>
<li>Redirect to the original URL when the short link is accessed</li>
<li>Track the number of clicks on each short link</li>
<li>Optionally, allow custom aliases for short links</li>
</ul>
<h4 id="technologies-used">Technologies Used</h4>
<ul>
<li><strong>Node.js</strong>: Backend runtime environment</li>
<li><strong>Express.js</strong>: Web framework for Node.js</li>
<li><strong>MongoDB</strong>: NoSQL database to store URL mappings</li>
<li><strong>Mongoose</strong>: ODM library for MongoDB and Node.js</li>
<li><strong>Nodemon</strong>: Development tool for automatic server restarts</li>
</ul>
<h4 id="project-structure">Project Structure</h4>
<pre class="hljs"><code><div>url-shortener/
├── models/
│   └── Url.js
├── routes/
│   └── urlRoutes.js
├── controllers/
│   └── urlController.js
├── public/
│   └── index.html
├── app.js
└── package.json
</div></code></pre>
<h4 id="setting-up-the-project">Setting Up the Project</h4>
<ol>
<li>
<p><strong>Initialize Node.js Project</strong></p>
<pre class="hljs"><code><div>mkdir url-shortener
<span class="hljs-built_in">cd</span> url-shortener
npm init -y
</div></code></pre>
</li>
<li>
<p><strong>Install Dependencies</strong></p>
<pre class="hljs"><code><div>npm install express mongoose
npm install --save-dev nodemon
</div></code></pre>
</li>
<li>
<p><strong>Create Project Structure</strong></p>
<pre class="hljs"><code><div>mkdir models routes controllers public
touch app.js
</div></code></pre>
</li>
<li>
<p><strong>Define URL Model (models/Url.js)</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">const</span> urlSchema = <span class="hljs-keyword">new</span> mongoose.Schema({
	<span class="hljs-attr">originalUrl</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
	<span class="hljs-attr">shortCode</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span> },
	<span class="hljs-attr">clicks</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">0</span> },
});

<span class="hljs-built_in">module</span>.exports = mongoose.model(<span class="hljs-string">'Url'</span>, urlSchema);
</div></code></pre>
</li>
<li>
<p><strong>Create URL Controller (controllers/urlController.js)</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> Url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/Url'</span>);

exports.shortenUrl = <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">const</span> { originalUrl } = req.body;
	<span class="hljs-keyword">const</span> shortCode = <span class="hljs-built_in">Math</span>.random() <span class="hljs-comment">// 0.7834592847563</span>
		.toString(<span class="hljs-number">36</span>) <span class="hljs-comment">// "0.s8w7xqp4zk"</span>
		.substring(<span class="hljs-number">2</span>, <span class="hljs-number">8</span>); <span class="hljs-comment">// "s8w7xq"</span>

	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> Url({ originalUrl, shortCode });
		<span class="hljs-keyword">await</span> url.save();
		res.status(<span class="hljs-number">201</span>).json(url);
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">400</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
};

exports.redirectUrl = <span class="hljs-keyword">async</span> (req, res) =&gt; {
	<span class="hljs-keyword">const</span> { shortCode } = req.params;

	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> url = <span class="hljs-keyword">await</span> Url.findOne({ shortCode });
		<span class="hljs-keyword">if</span> (!url) <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">404</span>).send(<span class="hljs-string">'URL not found'</span>);

		url.clicks++;
		<span class="hljs-keyword">await</span> url.save();

		res.redirect(url.originalUrl);
	} <span class="hljs-keyword">catch</span> (error) {
		res.status(<span class="hljs-number">500</span>).json({ <span class="hljs-attr">error</span>: error.message });
	}
};
</div></code></pre>
</li>
<li>
<p><strong>Define URL Routes (routes/urlRoutes.js)</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> urlController = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../controllers/urlController'</span>);

<span class="hljs-keyword">const</span> router = express.Router();

router.post(<span class="hljs-string">'/shorten'</span>, urlController.shortenUrl);
router.get(<span class="hljs-string">'/:shortCode'</span>, urlController.redirectUrl);

<span class="hljs-built_in">module</span>.exports = router;
</div></code></pre>
</li>
<li>
<p><strong>Set Up Express Server (app.js)</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> urlRoutes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./routes/urlRoutes'</span>);

<span class="hljs-keyword">const</span> app = express();

<span class="hljs-comment">// Middleware</span>
app.use(express.json());
app.use(express.static(<span class="hljs-string">'public'</span>));

<span class="hljs-comment">// Routes</span>
app.use(<span class="hljs-string">'/api/urls'</span>, urlRoutes);

<span class="hljs-comment">// Connect to MongoDB</span>
mongoose
	.connect(<span class="hljs-string">'mongodb://localhost:27017/urlshortener'</span>)
	.then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'MongoDB Connected'</span>))
	.catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'MongoDB connection error:'</span>, err));

app.listen(<span class="hljs-number">3000</span>, () =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server running on port 3000'</span>);
});
</div></code></pre>
</li>
<li>
<p><strong>Create Frontend Form (public/index.html)</strong></p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>URL Shortener<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>URL Shortener<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"urlForm"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">input</span>
				<span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
				<span class="hljs-attr">id</span>=<span class="hljs-string">"originalUrl"</span>
				<span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Enter URL to shorten"</span>
				<span class="hljs-attr">required</span>
			/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>Shorten<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"result"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
			<span class="hljs-built_in">document</span>
				.getElementById(<span class="hljs-string">'urlForm'</span>)
				.addEventListener(<span class="hljs-string">'submit'</span>, <span class="hljs-keyword">async</span> (e) =&gt; {
					e.preventDefault();
					<span class="hljs-keyword">const</span> originalUrl = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'originalUrl'</span>).value;

					<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">'/api/urls/shorten'</span>, {
						<span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
						<span class="hljs-attr">headers</span>: {
							<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
						},
						<span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({ originalUrl }),
					});
					<span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.json();
					<span class="hljs-keyword">if</span> (response.ok) {
						<span class="hljs-built_in">document</span>.getElementById(
							<span class="hljs-string">'result'</span>
						).innerHTML = <span class="hljs-string">`Short URL: &lt;a href="/api/urls/<span class="hljs-subst">${data.shortCode}</span>"&gt;<span class="hljs-subst">${data.shortCode}</span>&lt;/a&gt;`</span>;
					} <span class="hljs-keyword">else</span> {
						<span class="hljs-built_in">document</span>.getElementById(
							<span class="hljs-string">'result'</span>
						).innerHTML = <span class="hljs-string">`Error: <span class="hljs-subst">${data.error}</span>`</span>;
					}
				});
		</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>
</li>
<li>
<p><strong>Run the Application</strong></p>
<pre class="hljs"><code><div>npm run dev
</div></code></pre>
</li>
<li>
<p><strong>Test the URL Shortener</strong></p>
</li>
</ol>
<ul>
<li>Open your browser and go to <code>http://localhost:3000</code>.</li>
<li>Enter a long URL and click &quot;Shorten&quot;.</li>
<li>Copy the short URL and test the redirection.</li>
</ul>
<h3 id="62-discord-bot-in-nodejs">6.2 Discord Bot in Node.js</h3>
<p>A Discord bot is a program that interacts with the Discord API to automate tasks, provide information, or entertain users on Discord servers. Discord bots can perform a wide range of functions, from moderating servers to playing music or providing game stats.</p>
<h4 id="features">Features</h4>
<ul>
<li>Respond to user commands</li>
<li>Send automated messages or alerts</li>
<li>Moderate chat (e.g., mute, kick, ban users)</li>
<li>Provide information (e.g., weather, news, game stats)</li>
<li>Play music in voice channels</li>
<li>Customizable prefixes and command handling</li>
</ul>
<h4 id="technologies-used">Technologies Used</h4>
<ul>
<li><strong>Node.js</strong>: Backend runtime environment</li>
<li><strong>Discord.js</strong>: Powerful library to interact with the Discord API</li>
<li><strong>Nodemon</strong>: Development tool for automatic server restarts</li>
</ul>
<h4 id="project-structure">Project Structure</h4>
<pre class="hljs"><code><div>discord-bot/
├── commands/
│   ├── ping.js
│   └── ban.js
├── events/
│   ├── ready.js
│   └── message.js
├── config.json
├── index.js
└── package.json
</div></code></pre>
<h4 id="setting-up-the-project">Setting Up the Project</h4>
<ol>
<li>
<p><strong>Initialize Node.js Project</strong></p>
<pre class="hljs"><code><div>mkdir discord-bot
<span class="hljs-built_in">cd</span> discord-bot
npm init -y
</div></code></pre>
</li>
<li>
<p><strong>Install Dependencies</strong></p>
<pre class="hljs"><code><div>npm install discord.js
npm install --save-dev nodemon
</div></code></pre>
</li>
<li>
<p><strong>Create Project Structure</strong></p>
<pre class="hljs"><code><div>mkdir commands events
touch index.js
</div></code></pre>
</li>
<li>
<p><strong>Create Bot Configuration (config.json)</strong></p>
<pre class="hljs"><code><div>{
	<span class="hljs-attr">"token"</span>: <span class="hljs-string">"YOUR_BOT_TOKEN"</span>,
	<span class="hljs-attr">"prefix"</span>: <span class="hljs-string">"!"</span>
}
</div></code></pre>
</li>
<li>
<p><strong>Set Up Bot Client (index.js)</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> { Client, Intents } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'discord.js'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config.json'</span>);

<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Client({
	<span class="hljs-attr">intents</span>: [Intents.FLAGS.GUILDS, Intents.FLAGS.GUILD_MESSAGES],
});

<span class="hljs-comment">// Load commands</span>
client.commands = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>();
<span class="hljs-keyword">const</span> commandFiles = fs
	.readdirSync(path.join(__dirname, <span class="hljs-string">'commands'</span>))
	.filter(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> file.endsWith(<span class="hljs-string">'.js'</span>));
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> commandFiles) {
	<span class="hljs-keyword">const</span> command = <span class="hljs-built_in">require</span>(<span class="hljs-string">`./commands/<span class="hljs-subst">${file}</span>`</span>);
	client.commands.set(command.data.name, command);
}

<span class="hljs-comment">// Load events</span>
<span class="hljs-keyword">const</span> eventFiles = fs
	.readdirSync(path.join(__dirname, <span class="hljs-string">'events'</span>))
	.filter(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> file.endsWith(<span class="hljs-string">'.js'</span>));
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> eventFiles) {
	<span class="hljs-keyword">const</span> event = <span class="hljs-built_in">require</span>(<span class="hljs-string">`./events/<span class="hljs-subst">${file}</span>`</span>);
	client.on(event.name, (...args) =&gt; event.execute(...args, client));
}

client.login(config.token);
</div></code></pre>
</li>
<li>
<p><strong>Create Command Example (commands/ping.js)</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> { SlashCommandBuilder } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@discordjs/builders'</span>);

<span class="hljs-built_in">module</span>.exports = {
	<span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> SlashCommandBuilder()
		.setName(<span class="hljs-string">'ping'</span>)
		.setDescription(<span class="hljs-string">'Replies with Pong!'</span>),
	<span class="hljs-keyword">async</span> execute(interaction) {
		<span class="hljs-keyword">await</span> interaction.reply(<span class="hljs-string">'Pong!'</span>);
	},
};
</div></code></pre>
</li>
<li>
<p><strong>Create Event Example (events/ready.js)</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">module</span>.exports = {
	<span class="hljs-attr">name</span>: <span class="hljs-string">'ready'</span>,
	<span class="hljs-attr">once</span>: <span class="hljs-literal">true</span>,
	execute(client) {
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Logged in as <span class="hljs-subst">${client.user.tag}</span>`</span>);
	},
};
</div></code></pre>
</li>
<li>
<p><strong>Run the Bot</strong></p>
<pre class="hljs"><code><div>node index.js
</div></code></pre>
</li>
<li>
<p><strong>Test the Discord Bot</strong></p>
<ul>
<li>Invite the bot to your Discord server using the OAuth2 URL generated in the Discord Developer Portal.</li>
<li>Test the bot commands and events in your Discord server.</li>
</ul>
</li>
</ol>
<h3 id="63-file-uploads-with-multer">6.3 File Uploads with Multer</h3>
<p>Multer is a Node.js middleware for handling <code>multipart/form-data</code>, which is used for uploading files. It is written on top of the busboy library and provides a simple way to handle file uploads in Express.js applications.</p>
<h4 id="features">Features</h4>
<ul>
<li>Upload single or multiple files</li>
<li>Store files on disk with custom naming</li>
<li>Access uploaded files via URL</li>
<li>Simple form-based file uploads</li>
<li>File metadata and path information</li>
</ul>
<h4 id="technologies-used">Technologies Used</h4>
<ul>
<li><strong>Node.js</strong>: Backend runtime environment</li>
<li><strong>Express.js</strong>: Web framework for Node.js</li>
<li><strong>Multer</strong>: Middleware for handling file uploads</li>
<li><strong>EJS</strong>: Templating engine for rendering views</li>
</ul>
<h4 id="project-structure">Project Structure</h4>
<pre class="hljs"><code><div>file-upload/
├── uploads/
├── views/
│   └── homepage.ejs
├── index.js
└── package.json
</div></code></pre>
<h4 id="setting-up-the-project">Setting Up the Project</h4>
<ol>
<li>
<p><strong>Initialize Node.js Project</strong></p>
<pre class="hljs"><code><div>mkdir file-upload
<span class="hljs-built_in">cd</span> file-upload
npm init -y
</div></code></pre>
</li>
<li>
<p><strong>Install Dependencies</strong></p>
<pre class="hljs"><code><div>npm install express multer ejs
npm install --save-dev nodemon
</div></code></pre>
</li>
<li>
<p><strong>Create Project Structure</strong></p>
<pre class="hljs"><code><div>mkdir uploads views
touch index.js
</div></code></pre>
</li>
<li>
<p><strong>Set Up File Uploads with Multer (index.js)</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> multer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'multer'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> app = express();
<span class="hljs-keyword">const</span> PORT = <span class="hljs-number">3000</span>;

<span class="hljs-comment">// Using diskStorage for better file control</span>
<span class="hljs-keyword">const</span> storage = multer.diskStorage({
	<span class="hljs-attr">destination</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, file, cb</span>) </span>{
		cb(<span class="hljs-literal">null</span>, <span class="hljs-string">'uploads/'</span>); <span class="hljs-comment">// directory where files will be saved</span>
	},
	<span class="hljs-attr">filename</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, file, cb</span>) </span>{
		cb(<span class="hljs-literal">null</span>, <span class="hljs-built_in">Date</span>.now() + <span class="hljs-string">'-'</span> + file.originalname); <span class="hljs-comment">// unique filename</span>
	},
});
<span class="hljs-keyword">const</span> upload = multer({ <span class="hljs-attr">storage</span>: storage });

<span class="hljs-comment">// Set EJS as the view engine</span>
app.set(<span class="hljs-string">'view engine'</span>, <span class="hljs-string">'ejs'</span>);
app.set(<span class="hljs-string">'views'</span>, path.resolve(<span class="hljs-string">'./views'</span>));

<span class="hljs-comment">// Serve uploaded files as static content</span>
app.use(<span class="hljs-string">'/uploads'</span>, express.static(<span class="hljs-string">'uploads'</span>));

app.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
	res.render(<span class="hljs-string">'homepage'</span>);
});

app.post(<span class="hljs-string">'/upload'</span>, upload.single(<span class="hljs-string">'yourFile'</span>), (req, res) =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'File uploaded:'</span>, req.file);
	res.redirect(<span class="hljs-string">'/'</span>);
});

app.listen(PORT, () =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Server is running on http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
});
</div></code></pre>
</li>
<li>
<p><strong>Create Upload Form (views/homepage.ejs)</strong></p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>File Upload<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>File Upload<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/upload"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">"multipart/form-data"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"yourFile"</span> /&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>Upload<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>
</li>
<li>
<p><strong>Update package.json Scripts</strong></p>
<pre class="hljs"><code><div>{
	<span class="hljs-attr">"scripts"</span>: {
		<span class="hljs-attr">"start"</span>: <span class="hljs-string">"node index.js"</span>,
		<span class="hljs-attr">"dev"</span>: <span class="hljs-string">"nodemon index.js"</span>
	}
}
</div></code></pre>
</li>
<li>
<p><strong>Run the Application</strong></p>
<pre class="hljs"><code><div>npm run dev
</div></code></pre>
</li>
<li>
<p><strong>Test File Uploads</strong></p>
<ul>
<li>Open browser to <code>http://localhost:3000</code></li>
<li>Select a file and click &quot;Upload&quot;</li>
<li>Check console for file details</li>
<li>Access uploaded files at <code>http://localhost:3000/uploads/filename</code></li>
</ul>
</li>
</ol>
<h4 id="key-features-explained">Key Features Explained</h4>
<p><strong>DiskStorage Configuration:</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> storage = multer.diskStorage({
	<span class="hljs-attr">destination</span>: <span class="hljs-string">'uploads/'</span>,
	<span class="hljs-attr">filename</span>: <span class="hljs-built_in">Date</span>.now() + <span class="hljs-string">'-'</span> + file.originalname,
});
</div></code></pre>
<p><strong>File Information:</strong>
When a file is uploaded, you get detailed information:</p>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">fieldname</span>: <span class="hljs-string">'yourFile'</span>,
  <span class="hljs-attr">originalname</span>: <span class="hljs-string">'profile.jpg'</span>,
  <span class="hljs-attr">encoding</span>: <span class="hljs-string">'7bit'</span>,
  <span class="hljs-attr">mimetype</span>: <span class="hljs-string">'image/jpeg'</span>,
  <span class="hljs-attr">destination</span>: <span class="hljs-string">'uploads/'</span>,
  <span class="hljs-attr">filename</span>: <span class="hljs-string">'1751617189467-profile.jpg'</span>,
  <span class="hljs-attr">path</span>: <span class="hljs-string">'uploads/1751617189467-profile.jpg'</span>,
  <span class="hljs-attr">size</span>: <span class="hljs-number">107896</span>
}
</div></code></pre>
<p>This simple file upload system provides a complete solution for handling file uploads with proper storage and access functionality.</p>
<h3 id="64-blog-application-nodejs-mongodb-ejs">6.4 Blog Application (Node.js, MongoDB, EJS)</h3>
<p>A blog application is a web application that allows users to create, read, update, and delete blog posts. It typically includes user authentication, a rich text editor for writing posts, and a comment system.</p>
<h4 id="features">Features</h4>
<ul>
<li>User registration and authentication</li>
<li>Create, edit, delete blog posts</li>
<li>Like and comment on blog posts</li>
</ul>
<h4 id="technologies-used">Technologies Used</h4>
<ul>
<li><strong>Node.js</strong>: Backend runtime environment</li>
<li><strong>Express.js</strong>: Web framework for Node.js</li>
<li><strong>MongoDB</strong>: NoSQL database to store blog posts and user data</li>
<li><strong>Mongoose</strong>: ODM library for MongoDB and Node.js</li>
<li><strong>jwt</strong>: JSON Web Tokens for user authentication</li>
<li><strong>EJS</strong>: Templating engine to render HTML views</li>
<li><strong>Nodemon</strong>: Development tool for automatic server restarts</li>
</ul>
<h4 id="github-link-blogify-github">&gt; Github Link: <a href="https://github.com/decodewithdeepak/node-js/tree/master/9_blog-app">Blogify Github</a></h4>
<h2 id="7-deployment--performance">7. Deployment &amp; Performance</h2>
<h3 id="71-vercel-deployment">7.1 Vercel Deployment</h3>
<p>Vercel is a popular serverless platform optimized for frontend frameworks and Node.js applications. It provides excellent developer experience with zero-configuration deployments. The only catch is that it is primarily designed for serverless functions, so you need to adapt your Node.js app accordingly.</p>
<h4 id="why-vercel-for-nodejs">Why Vercel for Node.js?</h4>
<ul>
<li><strong>Zero Configuration</strong>: Deploy with minimal setup</li>
<li><strong>Automatic HTTPS</strong>: Built-in SSL certificates</li>
<li><strong>Global CDN</strong>: Fast content delivery worldwide</li>
<li><strong>GitHub Integration</strong>: Automatic deployments on git push</li>
<li><strong>Environment Variables</strong>: Easy configuration management</li>
<li><strong>Custom Domains</strong>: Free custom domain support</li>
<li><strong>Serverless Functions</strong>: Run backend code without managing servers</li>
</ul>
<h4 id="step-by-step-vercel-deployment">Step-by-Step Vercel Deployment</h4>
<ol>
<li>
<p><strong>Install Vercel CLI</strong></p>
<pre class="hljs"><code><div>npm install -g vercel
</div></code></pre>
</li>
<li>
<p><strong>Prepare Your Node.js App</strong></p>
<p>Your project structure should look like:</p>
<pre class="hljs"><code><div>my-app/
├── app.js          # Main application file
├── package.json    # Dependencies and scripts
├── vercel.json     # Vercel configuration (optional)
└── .env            # Environment variables (local only)
</div></code></pre>
</li>
<li>
<p><strong>Create vercel.json Configuration</strong></p>
<pre class="hljs"><code><div>{
	<span class="hljs-attr">"version"</span>: <span class="hljs-number">2</span>,
	<span class="hljs-attr">"builds"</span>: [
		{
			<span class="hljs-attr">"src"</span>: <span class="hljs-string">"./app.js"</span>,
			<span class="hljs-attr">"use"</span>: <span class="hljs-string">"@vercel/node"</span>
		}
	],
	<span class="hljs-attr">"routes"</span>: [
		{
			<span class="hljs-attr">"src"</span>: <span class="hljs-string">"/(.*)"</span>,
			<span class="hljs-attr">"dest"</span>: <span class="hljs-string">"/app.js"</span>
		}
	]
}
</div></code></pre>
</li>
<li>
<p><strong>Modify Your Express App for Serverless</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = express();

<span class="hljs-comment">// Middleware and routes</span>
app.use(express.json());

app.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
	res.send(<span class="hljs-string">'Hello Vercel!'</span>);
});

<span class="hljs-comment">// For local development</span>
<span class="hljs-keyword">if</span> (process.env.NODE_ENV !== <span class="hljs-string">'production'</span>) {
	<span class="hljs-keyword">const</span> PORT = process.env.PORT || <span class="hljs-number">3000</span>;
	app.listen(PORT, () =&gt; {
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Server running on http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
	});
}

<span class="hljs-comment">// Export for serverless</span>
<span class="hljs-built_in">module</span>.exports = app;
</div></code></pre>
</li>
<li>
<p><strong>Deploy to Vercel</strong></p>
<pre class="hljs"><code><div>vercel login      <span class="hljs-comment"># Login to your Vercel account</span>
vercel            <span class="hljs-comment"># Deploy the project</span>
vercel --prod     <span class="hljs-comment"># Deploy to production</span>
</div></code></pre>
</li>
<li>
<p><strong>Set Environment Variables</strong></p>
<pre class="hljs"><code><div>vercel env add MONGODB_URI
vercel env add JWT_SECRET
</div></code></pre>
<p>Or via Vercel Dashboard:</p>
<ul>
<li>Go to your project settings</li>
<li>Navigate to Environment Variables</li>
<li>Add your variables for Production, Preview, and Development</li>
</ul>
<blockquote>
<p>Use MongoDB Atlas cloud database for production to maintain consistency across environments.</p>
</blockquote>
</li>
</ol>
<h3 id="72-aws-deployment">7.2 AWS Deployment</h3>
<p>Deploying Node.js applications on AWS can be done using various services like EC2, Elastic Beanstalk, or Lambda (for serverless).</p>
<h4 id="deploying-on-ec2">Deploying on EC2</h4>
<ol>
<li><strong>Launch an EC2 Instance</strong>: Choose an Amazon Machine Image (AMI) with Node.js pre-installed or install Node.js manually on a basic Linux AMI.</li>
<li><strong>Connect to the Instance</strong>: Use SSH to connect to your EC2 instance.</li>
<li><strong>Transfer Files</strong>: Use SCP or SFTP to transfer your application files to the EC2 instance.</li>
<li><strong>Install Dependencies</strong>: SSH into your instance and run <code>npm install</code> to install your app's dependencies.</li>
<li><strong>Start the Application</strong>: Use <code>node</code> or <code>npm start</code> to start your application. Consider using a process manager like PM2 to keep your app running.</li>
<li><strong>Configure Security Group</strong>: Ensure your EC2 instance's security group allows inbound traffic on the port your app is running (e.g., port 3000).</li>
<li><strong>Access the Application</strong>: Open a browser and go to <code>http://&lt;your-ec2-public-dns&gt;:3000</code>.</li>
</ol>
<h4 id="deploying-on-elastic-beanstalk">Deploying on Elastic Beanstalk</h4>
<ol>
<li><strong>Package Your Application</strong>: Ensure your application is working locally and create a ZIP file of your project.</li>
<li><strong>Create an Elastic Beanstalk Environment</strong>: In the AWS Management Console, go to Elastic Beanstalk and create a new environment.</li>
<li><strong>Upload and Deploy</strong>: Upload your ZIP file and deploy it to the Elastic Beanstalk environment.</li>
<li><strong>Configure Environment Variables</strong>: Set any necessary environment variables in the Elastic Beanstalk console.</li>
<li><strong>Access the Application</strong>: Once deployed, Elastic Beanstalk provides a URL to access your application.</li>
</ol>
<h3 id="73-serverless-framework--aws-lambda">7.3 Serverless Framework + AWS Lambda</h3>
<p>Serverless computing allows you to build and run applications without having to manage servers. AWS Lambda is a serverless compute service that runs your code in response to events and automatically manages the underlying compute resources.</p>
<h4 id="serverless-vs-monolithic">Serverless vs Monolithic</h4>
<p>Serverless applications are event-driven and run in stateless compute containers, while monolithic applications are typically deployed on a single server or cluster. EC2 is a good choice for monolithic applications, while AWS Lambda is ideal for serverless architectures.</p>
<h4 id="serverless-framework">Serverless Framework</h4>
<p>The Serverless Framework is an open-source framework that simplifies the development and deployment of serverless applications.</p>
<ol>
<li>
<p><strong>Install Serverless Framework</strong></p>
<pre class="hljs"><code><div>npm install -g serverless
</div></code></pre>
</li>
<li>
<p><strong>Create a Serverless Service</strong></p>
<pre class="hljs"><code><div>serverless create --template aws-nodejs --path my-service
<span class="hljs-built_in">cd</span> my-service
</div></code></pre>
</li>
<li>
<p><strong>Configure serverless.yml</strong></p>
<pre class="hljs"><code><div><span class="hljs-attr">service:</span> <span class="hljs-string">my-service</span>

<span class="hljs-attr">provider:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">aws</span>
  <span class="hljs-attr">runtime:</span> <span class="hljs-string">nodejs14.x</span>

<span class="hljs-attr">functions:</span>
  <span class="hljs-attr">hello:</span>
    <span class="hljs-attr">handler:</span> <span class="hljs-string">handler.hello</span>
    <span class="hljs-attr">events:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">http:</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">hello</span>
          <span class="hljs-attr">method:</span> <span class="hljs-string">get</span>
</div></code></pre>
</li>
<li>
<p><strong>Deploy the Service</strong></p>
<pre class="hljs"><code><div>serverless deploy
</div></code></pre>
</li>
<li>
<p><strong>Invoke the Function</strong></p>
<pre class="hljs"><code><div>serverless invoke -f hello
</div></code></pre>
</li>
<li>
<p><strong>View Logs</strong></p>
<pre class="hljs"><code><div>serverless logs -f hello
</div></code></pre>
</li>
<li>
<p><strong>Remove the Service</strong></p>
<pre class="hljs"><code><div>serverless remove
</div></code></pre>
</li>
</ol>
<h3 id="74-scaling-nodejs-with-cluster">7.4 Scaling Node.js with Cluster</h3>
<p>Node.js is single-threaded by default, which means it can only utilize one CPU core. However, you can scale your Node.js application across multiple CPU cores using the built-in Cluster module. This allows you to create child processes (workers) that share the same server port.</p>
<h4 id="basic-usage">Basic Usage</h4>
<ol>
<li>
<p><strong>Require the Cluster Module</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> cluster = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cluster'</span>);
<span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> numCPUs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>).cpus().length;
</div></code></pre>
</li>
<li>
<p><strong>Fork Workers</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">if</span> (cluster.isPrimary) {
	<span class="hljs-comment">// Fork workers</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; numCPUs; i++) {
		cluster.fork();
	}

	cluster.on(<span class="hljs-string">'exit'</span>, (worker, code, signal) =&gt; {
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Worker <span class="hljs-subst">${worker.process.pid}</span> died`</span>);
	});
} <span class="hljs-keyword">else</span> {
	<span class="hljs-comment">// Workers can share any TCP connection</span>
	<span class="hljs-comment">// In this case, it is an HTTP server</span>
	http
		.createServer(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
			res.writeHead(<span class="hljs-number">200</span>);
			res.end(<span class="hljs-string">'Hello World\n'</span>);
		})
		.listen(<span class="hljs-number">8000</span>);
}
</div></code></pre>
</li>
<li>
<p><strong>Run the Application</strong></p>
<pre class="hljs"><code><div>node app.js
</div></code></pre>
</li>
<li>
<p><strong>Test the Clustered Application</strong></p>
<ul>
<li>Send requests to the server and observe that multiple worker processes handle the requests.</li>
</ul>
</li>
</ol>
<h3 id="75-nginx-setup-serve-static-content-ssl-with-letsencrypt">7.5 NGINX (Setup, Serve Static Content, SSL with LetsEncrypt)</h3>
<p>NGINX (Engine-X) is a high-performance open-source web server that uses a non-threaded, event-driven architecture to handle multiple concurrent requests efficiently. It can also be used as a reverse proxy, load balancer, and HTTP cache.</p>
<p>NGINX is often used to serve static content, reverse proxy Node.js applications, and handle SSL termination.</p>
<h4 id="installing-nginx">Installing NGINX</h4>
<p>To install NGINX on a Linux server (e.g., Ubuntu), follow these steps:</p>
<pre class="hljs"><code><div>sudo apt update
sudo apt install nginx
</div></code></pre>
<h4 id="configuring-nginx">Configuring NGINX</h4>
<ol>
<li>
<p><strong>Basic Configuration</strong>: Edit the default configuration file</p>
<pre class="hljs"><code><div>sudo nano /etc/nginx/sites-available/default
</div></code></pre>
<ul>
<li>Set the server name and root directory</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-section">server</span> {
    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;
    <span class="hljs-attribute">server_name</span> your_domain.com;
    <span class="hljs-attribute">root</span> /var/www/html;
    <span class="hljs-attribute">index</span> index.html;
}
</div></code></pre>
</li>
<li>
<p><strong>Reverse Proxy to Node.js</strong>: If your Node.js app is running on a different port (e.g., 3000), set up a reverse proxy</p>
<pre class="hljs"><code><div><span class="hljs-attribute">location</span> / {
    <span class="hljs-attribute">proxy_pass</span> http://localhost:3000;
    <span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;
    <span class="hljs-attribute">proxy_set_header</span> Upgrade <span class="hljs-variable">$http_upgrade</span>;
    <span class="hljs-attribute">proxy_set_header</span> Connection <span class="hljs-string">'upgrade'</span>;
    <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;
    <span class="hljs-attribute">proxy_cache_bypass</span> <span class="hljs-variable">$http_upgrade</span>;
}
</div></code></pre>
</li>
<li>
<p><strong>Test and Restart NGINX</strong></p>
<pre class="hljs"><code><div>sudo nginx -t
sudo systemctl restart nginx
</div></code></pre>
</li>
</ol>
<h4 id="serving-static-content">Serving Static Content</h4>
<ul>
<li>Place your static files (HTML, CSS, JS) in the directory specified by the <code>root</code> directive in your NGINX configuration (e.g., <code>/var/www/html</code>).</li>
<li>NGINX will automatically serve these files when requested.</li>
</ul>
<h4 id="ssl-with-letsencrypt">SSL with LetsEncrypt</h4>
<ol>
<li>
<p><strong>Install Certbot</strong></p>
<pre class="hljs"><code><div>sudo apt install certbot python3-certbot-nginx
</div></code></pre>
</li>
<li>
<p><strong>Obtain an SSL Certificate</strong></p>
<pre class="hljs"><code><div>sudo certbot --nginx -d your_domain.com
</div></code></pre>
</li>
<li>
<p><strong>Automatic Renewal</strong>: Certbot sets up a cron job for automatic renewal. You can test the renewal process with:</p>
<pre class="hljs"><code><div>sudo certbot renew --dry-run
</div></code></pre>
</li>
</ol>
<h2 id="8-real-time-and-streams">8. Real-time and Streams</h2>
<h3 id="81-websocket-with-socketio">8.1 WebSocket with Socket.IO</h3>
<p>Socket.IO is a JavaScript library for real-time web applications. It enables real-time, bidirectional, and event-based communication between the browser and the server.</p>
<h4 id="features">Features</h4>
<ul>
<li>Real-time communication</li>
<li>Automatic reconnection</li>
<li>Room and namespace support</li>
<li>Binary data support</li>
</ul>
<h4 id="technologies-used">Technologies Used</h4>
<ul>
<li><strong>Node.js</strong>: Backend runtime environment</li>
<li><strong>Socket.IO</strong>: Library for real-time communication</li>
</ul>
<h4 id="project-structure">Project Structure</h4>
<pre class="hljs"><code><div>realtime-app/
├── public/
│   └── index.html
├── app.js
└── package.json
</div></code></pre>
<h4 id="setting-up-the-project">Setting Up the Project</h4>
<ol>
<li>
<p><strong>Initialize Node.js Project</strong></p>
<pre class="hljs"><code><div>mkdir realtime-app
<span class="hljs-built_in">cd</span> realtime-app
npm init -y
</div></code></pre>
</li>
<li>
<p><strong>Install Dependencies</strong></p>
<pre class="hljs"><code><div>npm install express socket.io
</div></code></pre>
</li>
<li>
<p><strong>Create Project Structure</strong></p>
<pre class="hljs"><code><div>mkdir public
touch app.js
</div></code></pre>
</li>
<li>
<p><strong>Set Up Express and Socket.IO (app.js)</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> socketIo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'socket.io'</span>);

<span class="hljs-keyword">const</span> app = express();
<span class="hljs-keyword">const</span> server = http.createServer(app);
<span class="hljs-keyword">const</span> io = socketIo(server);

app.use(express.static(<span class="hljs-string">'public'</span>));

io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'A user connected: '</span> + socket.id);
	socket.on(<span class="hljs-string">'chat message'</span>, (msg) =&gt; {
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Message received from '</span> + socket.id + <span class="hljs-string">': '</span> + msg);
		io.emit(<span class="hljs-string">'chat message'</span>, msg); <span class="hljs-comment">// Broadcast the message to all connected clients</span>
	});
	socket.on(<span class="hljs-string">'disconnect'</span>, () =&gt; {
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'A user disconnected: '</span> + socket.id);
	});
});

server.listen(<span class="hljs-number">3000</span>, () =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Server is running on http://localhost:3000`</span>);
});
</div></code></pre>
</li>
<li>
<p><strong>Create Client-side Code (public/index.html)</strong></p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Real-time Chat App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Real-time Communication with Socket.IO<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"messages"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"messageInput"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Type a message..."</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sendButton"</span>&gt;</span>Send<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/socket.io/socket.io.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
			<span class="hljs-keyword">const</span> socket = io();

			<span class="hljs-keyword">const</span> messagesDiv = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'messages'</span>);
			<span class="hljs-keyword">const</span> messageInput = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'messageInput'</span>);
			<span class="hljs-keyword">const</span> sendButton = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'sendButton'</span>);

			sendButton.addEventListener(<span class="hljs-string">'click'</span>, () =&gt; {
				<span class="hljs-keyword">const</span> message = messageInput.value;
				socket.emit(<span class="hljs-string">'chat message'</span>, message);
				messageInput.value = <span class="hljs-string">''</span>;
			});

			socket.on(<span class="hljs-string">'chat message'</span>, (msg) =&gt; {
				<span class="hljs-keyword">const</span> messageElement = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
				messageElement.textContent = msg;
				messagesDiv.appendChild(messageElement);
			});
		</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>
</li>
<li>
<p><strong>Run the Application</strong></p>
<pre class="hljs"><code><div>node app.js
</div></code></pre>
</li>
<li>
<p><strong>Test Real-time Communication</strong></p>
<ul>
<li>Open multiple browser windows and go to <code>http://localhost:3000</code>.</li>
<li>Send messages and observe real-time updates in all connected clients.</li>
</ul>
</li>
</ol>
<h3 id="82-nodejs-streams">8.2 Node.js Streams</h3>
<p>Streams are objects that allow you to read data from a source or write data to a destination in a continuous fashion. They are used for handling reading/writing files, network communications, or any kind of end-to-end information exchange.</p>
<h4 id="why-use-streaming">Why Use Streaming?</h4>
<p>Streaming is a way to process data piece by piece (in chunks) rather than loading everything into memory at once. This is particularly useful for large files or data sources, as it reduces memory usage and allows for faster processing.</p>
<pre class="hljs"><code><div><span class="hljs-comment">// WITHOUT STREAMING (Bad for large files)</span>
app.get(<span class="hljs-string">'/download-movie'</span>, (req, res) =&gt; {
    fs.readFile(<span class="hljs-string">'movie.mp4'</span>, (err, data) =&gt; {
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
        res.send(data); <span class="hljs-comment">// Loads entire 2GB movie into memory first!</span>
    });
});

<span class="hljs-comment">// WITH STREAMING (Good!)</span>
app.get(<span class="hljs-string">'/download-movie'</span>, (req, res) =&gt; {
    <span class="hljs-keyword">const</span> stream = fs.createReadStream(<span class="hljs-string">'movie.mp4'</span>);
    stream.pipe(res); <span class="hljs-comment">// Sends chunks as they're read</span>
});
</div></code></pre>
<h4 id="types-of-streams">Types of Streams</h4>
<ul>
<li><strong>Readable Streams</strong>: Streams from which data can be read (e.g., <code>fs.createReadStream()</code>).</li>
<li><strong>Writable Streams</strong>: Streams to which data can be written (e.g., <code>fs.createWriteStream()</code>).</li>
<li><strong>Duplex Streams</strong>: Streams that are both readable and writable (e.g., TCP sockets).</li>
<li><strong>Transform Streams</strong>: Duplex streams that can modify or transform the data as it is written and read (e.g., zlib compression streams).</li>
</ul>
<h4 id="using-readable-streams">Using Readable Streams</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// Create a readable stream</span>
<span class="hljs-keyword">const</span> readStream = fs.createReadStream(<span class="hljs-string">'input.txt'</span>, <span class="hljs-string">'utf8'</span>);

<span class="hljs-comment">// Handle stream events</span>
readStream.on(<span class="hljs-string">'data'</span>, (chunk) =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Received chunk:'</span>, chunk);
});

readStream.on(<span class="hljs-string">'end'</span>, () =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'No more data in the stream.'</span>);
});

readStream.on(<span class="hljs-string">'error'</span>, (err) =&gt; {
	<span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Error:'</span>, err);
});
</div></code></pre>
<h4 id="using-writable-streams">Using Writable Streams</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// Create a writable stream</span>
<span class="hljs-keyword">const</span> writeStream = fs.createWriteStream(<span class="hljs-string">'output.txt'</span>);

<span class="hljs-comment">// Write data to the stream</span>
writeStream.write(<span class="hljs-string">'Hello, '</span>);
writeStream.write(<span class="hljs-string">'world!\n'</span>);
writeStream.end(<span class="hljs-string">'Goodbye, world!\n'</span>);

writeStream.on(<span class="hljs-string">'finish'</span>, () =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'All data has been written to the file.'</span>);
});

writeStream.on(<span class="hljs-string">'error'</span>, (err) =&gt; {
	<span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Error:'</span>, err);
});
</div></code></pre>
<h4 id="using-duplex-and-transform-streams">Using Duplex and Transform Streams</h4>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> { Transform } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'stream'</span>);

<span class="hljs-comment">// Create a transform stream</span>
<span class="hljs-keyword">const</span> reverseTransform = <span class="hljs-keyword">new</span> Transform({
	transform(chunk, encoding, callback) {
		<span class="hljs-comment">// Reverse the chunk and push it to the readable side</span>
		<span class="hljs-keyword">this</span>.push(chunk.toString().split(<span class="hljs-string">''</span>).reverse().join(<span class="hljs-string">''</span>));
		callback();
	},
});

<span class="hljs-comment">// Pipe readable stream through transform stream to writable stream</span>
readStream.pipe(reverseTransform).pipe(writeStream);
</div></code></pre>
<h2 id="9-graphql-with-nodejs">9. GraphQL with Node.js</h2>
<h3 id="91-graphql-crash-course">9.1 GraphQL Crash Course</h3>
<p>GraphQL is a query language for APIs and a runtime for executing those queries with your existing data. It provides a more efficient, powerful, and flexible alternative to the RESTful API.</p>
<h4 id="key-features-of-graphql">Key Features of GraphQL</h4>
<ul>
<li><strong>Declarative Data Fetching</strong>: Clients can request exactly the data they need, reducing over-fetching and under-fetching of data.</li>
<li><strong>Strongly Typed Schema</strong>: GraphQL APIs are defined by a schema using the GraphQL Schema Definition Language (SDL). The schema specifies the types, queries, and mutations available in the API.</li>
<li><strong>Single Endpoint</strong>: Unlike REST, which exposes multiple endpoints for different resources, a GraphQL API typically exposes a single endpoint for all interactions.</li>
<li><strong>Real-time Data with Subscriptions</strong>: GraphQL supports real-time updates through subscriptions, allowing clients to receive live data updates.</li>
</ul>
<h4 id="graphql-vs-rest">GraphQL vs REST</h4>
<ul>
<li><strong>Flexibility</strong>: GraphQL allows clients to specify the structure of the response, while REST returns fixed data structures.</li>
<li><strong>Efficiency</strong>: GraphQL reduces the number of requests and the amount of data transferred over the network.</li>
<li><strong>Versioning</strong>: GraphQL APIs are typically versionless, as clients can request only the fields they need.</li>
</ul>
<h3 id="92-setting-up-graphql-server">9.2 Setting up GraphQL Server</h3>
<ol>
<li>
<p><strong>Install Dependencies</strong></p>
<pre class="hljs"><code><div>npm install graphql express-graphql
</div></code></pre>
</li>
<li>
<p><strong>Create GraphQL Schema</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> {
	GraphQLSchema,
	GraphQLObjectType,
	GraphQLString,
} = <span class="hljs-built_in">require</span>(<span class="hljs-string">'graphql'</span>);

<span class="hljs-comment">// Define a simple User type</span>
<span class="hljs-keyword">const</span> UserType = <span class="hljs-keyword">new</span> GraphQLObjectType({
	<span class="hljs-attr">name</span>: <span class="hljs-string">'User'</span>,
	<span class="hljs-attr">fields</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
		<span class="hljs-attr">id</span>: { <span class="hljs-attr">type</span>: GraphQLString },
		<span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: GraphQLString },
		<span class="hljs-attr">email</span>: { <span class="hljs-attr">type</span>: GraphQLString },
	}),
});

<span class="hljs-comment">// Define the RootQuery type</span>
<span class="hljs-keyword">const</span> RootQuery = <span class="hljs-keyword">new</span> GraphQLObjectType({
	<span class="hljs-attr">name</span>: <span class="hljs-string">'RootQueryType'</span>,
	<span class="hljs-attr">fields</span>: {
		<span class="hljs-attr">user</span>: {
			<span class="hljs-attr">type</span>: UserType,
			<span class="hljs-attr">args</span>: { <span class="hljs-attr">id</span>: { <span class="hljs-attr">type</span>: GraphQLString } },
			resolve(parent, args) {
				<span class="hljs-comment">// Fetch data from the database or another source</span>
				<span class="hljs-keyword">return</span> { <span class="hljs-attr">id</span>: args.id, <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span> };
			},
		},
	},
});

<span class="hljs-comment">// Create the schema</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> GraphQLSchema({
	<span class="hljs-attr">query</span>: RootQuery,
});

<span class="hljs-built_in">module</span>.exports = schema;
</div></code></pre>
</li>
<li>
<p><strong>Set Up Express and GraphQL (app.js)</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> { graphqlHTTP } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express-graphql'</span>);
<span class="hljs-keyword">const</span> schema = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./schema'</span>);

<span class="hljs-keyword">const</span> app = express();

app.use(
	<span class="hljs-string">'/graphql'</span>,
	graphqlHTTP({
		schema,
		<span class="hljs-attr">graphiql</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Enable GraphiQL interface</span>
	})
);

app.listen(<span class="hljs-number">3000</span>, () =&gt; {
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Server running on port 3000'</span>);
});
</div></code></pre>
</li>
<li>
<p><strong>Test the GraphQL Server</strong></p>
<ul>
<li>Open your browser and go to <code>http://localhost:3000/graphql</code>.</li>
<li>Use the GraphiQL interface to test queries and mutations.</li>
</ul>
</li>
</ol>
<h3 id="93-prisma--postgresql-setup">9.3 Prisma + PostgreSQL Setup</h3>
<p>Prisma is a next-generation ORM for Node.js and TypeScript that simplifies database access and management. It provides a type-safe database client, migrations, and a powerful data modeling language.</p>
<ol>
<li>
<p><strong>Install Dependencies</strong></p>
<pre class="hljs"><code><div>npm install prisma @prisma/client
</div></code></pre>
</li>
<li>
<p><strong>Initialize Prisma</strong></p>
<pre class="hljs"><code><div>npx prisma init
</div></code></pre>
</li>
<li>
<p><strong>Configure Database Connection</strong></p>
<ul>
<li>Update the <code>DATABASE_URL</code> in the <code>.env</code> file to point to your PostgreSQL database.</li>
</ul>
<pre class="hljs"><code><div>DATABASE_URL=&quot;postgresql://USER:PASSWORD@HOST:PORT/DATABASE&quot;
</div></code></pre>
</li>
<li>
<p><strong>Define Data Model</strong></p>
<ul>
<li>Update the <code>schema.prisma</code> file with your data model.</li>
</ul>
<pre class="hljs"><code><div>datasource db {
    provider = &quot;postgresql&quot;
    url      = env(&quot;DATABASE_URL&quot;)
}

generator client {
    provider = &quot;prisma-client-js&quot;
}

model User {
    id    String @id @default(cuid())
    name  String
    email String @unique
}
</div></code></pre>
</li>
<li>
<p><strong>Run Migrations</strong></p>
<pre class="hljs"><code><div>npx prisma migrate dev --name init
</div></code></pre>
</li>
<li>
<p><strong>Generate Prisma Client</strong></p>
<pre class="hljs"><code><div>npx prisma generate
</div></code></pre>
</li>
<li>
<p><strong>Use Prisma Client in Your Application</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> { PrismaClient } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@prisma/client'</span>);
<span class="hljs-keyword">const</span> prisma = <span class="hljs-keyword">new</span> PrismaClient();

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-comment">// Create a new user</span>
	<span class="hljs-keyword">const</span> newUser = <span class="hljs-keyword">await</span> prisma.user.create({
		<span class="hljs-attr">data</span>: {
			<span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
			<span class="hljs-attr">email</span>: <span class="hljs-string">'alice@example.com'</span>,
		},
	});
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Created new user:'</span>, newUser);

	<span class="hljs-comment">// Fetch all users</span>
	<span class="hljs-keyword">const</span> allUsers = <span class="hljs-keyword">await</span> prisma.user.findMany();
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'All users:'</span>, allUsers);
}

main()
	.catch(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-built_in">console</span>.error(e))
	.finally(<span class="hljs-keyword">async</span> () =&gt; {
		<span class="hljs-keyword">await</span> prisma.$disconnect();
	});
</div></code></pre>
</li>
<li>
<p><strong>Run the Application</strong></p>
<pre class="hljs"><code><div>node app.js
</div></code></pre>
</li>
<li>
<p><strong>Test Prisma + PostgreSQL Integration</strong></p>
<ul>
<li>Test creating and fetching users in your application.</li>
</ul>
</li>
</ol>
<h3 id="94-refactoring-graphql-code">9.4 Refactoring GraphQL Code</h3>
<p>As your GraphQL schema and resolvers grow, it's important to keep your code organized and maintainable. Consider the following tips for refactoring GraphQL code:</p>
<ol>
<li>
<p><strong>Modularize Schema and Resolvers</strong></p>
<ul>
<li>Split your schema and resolvers into separate files and folders based on features or resources.</li>
</ul>
<pre class="hljs"><code><div>graphql
src/
├── graphql/
│   ├── schema/
│   │   ├── userSchema.js
│   │   └── postSchema.js
│   ├── resolvers/
│   │   ├── userResolvers.js
│   │   └── postResolvers.js
│   └── index.js
└── server.js
</div></code></pre>
</li>
<li>
<p><strong>Use GraphQL Modules</strong></p>
<ul>
<li>Consider using the <code>graphql-modules</code> library to organize your schema and resolvers into cohesive modules.</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> { createModule, gql } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'graphql-modules'</span>);

<span class="hljs-comment">// Define the User module</span>
<span class="hljs-keyword">const</span> UserModule = createModule({
	<span class="hljs-attr">id</span>: <span class="hljs-string">'user'</span>,
	<span class="hljs-attr">dirname</span>: __dirname,
	<span class="hljs-attr">typeDefs</span>: gql<span class="hljs-string">`
		type User {
			id: ID!
			name: String!
			email: String!
		}

		extend type Query {
			user(id: ID!): User
			users: [User!]!
		}

		extend type Mutation {
			createUser(name: String!, email: String!): User!
		}
	`</span>,
	<span class="hljs-attr">resolvers</span>: {
		<span class="hljs-attr">Query</span>: {
			<span class="hljs-attr">user</span>: <span class="hljs-function">(<span class="hljs-params">parent, args, context, info</span>) =&gt;</span> {
				<span class="hljs-comment">// Resolver logic</span>
			},
			<span class="hljs-attr">users</span>: <span class="hljs-function">(<span class="hljs-params">parent, args, context, info</span>) =&gt;</span> {
				<span class="hljs-comment">// Resolver logic</span>
			},
		},
		<span class="hljs-attr">Mutation</span>: {
			<span class="hljs-attr">createUser</span>: <span class="hljs-function">(<span class="hljs-params">parent, args, context, info</span>) =&gt;</span> {
				<span class="hljs-comment">// Resolver logic</span>
			},
		},
	},
});
</div></code></pre>
</li>
<li>
<p><strong>Use DataLoader for Batch Loading</strong></p>
<ul>
<li>Use the <code>dataloader</code> library to batch and cache database or API calls in your resolvers.</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> DataLoader = <span class="hljs-built_in">require</span>(<span class="hljs-string">'dataloader'</span>);

<span class="hljs-keyword">const</span> userLoader = <span class="hljs-keyword">new</span> DataLoader(<span class="hljs-keyword">async</span> (userIds) =&gt; {
	<span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> User.findByIds(userIds);
	<span class="hljs-keyword">return</span> userIds.map(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> users.find(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> user.id === id));
});

<span class="hljs-comment">// In your resolver</span>
<span class="hljs-keyword">const</span> resolvers = {
	<span class="hljs-attr">Post</span>: {
		<span class="hljs-attr">author</span>: <span class="hljs-function">(<span class="hljs-params">post</span>) =&gt;</span> userLoader.load(post.authorId),
	},
};
</div></code></pre>
</li>
<li>
<p><strong>Error Handling and Validation</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> { GraphQLError } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'graphql'</span>);

<span class="hljs-keyword">const</span> resolvers = {
	<span class="hljs-attr">Mutation</span>: {
		<span class="hljs-attr">createUser</span>: <span class="hljs-keyword">async</span> (parent, args, context) =&gt; {
			<span class="hljs-keyword">try</span> {
				<span class="hljs-comment">// Validate input</span>
				<span class="hljs-keyword">if</span> (!args.email) {
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(<span class="hljs-string">'Email is required'</span>, {
						<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'BAD_USER_INPUT'</span> },
					});
				}

				<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.create(args);
				<span class="hljs-keyword">return</span> user;
			} <span class="hljs-keyword">catch</span> (error) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(<span class="hljs-string">'Failed to create user'</span>, {
					<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'INTERNAL_ERROR'</span> },
				});
			}
		},
	},
};
</div></code></pre>
</li>
<li>
<p><strong>Use GraphQL Tools for Schema Composition</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> { makeExecutableSchema } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@graphql-tools/schema'</span>);

<span class="hljs-keyword">const</span> typeDefs = <span class="hljs-string">`
    type Query {
        users: [User]
        posts: [Post]
    }
`</span>;

<span class="hljs-keyword">const</span> schema = makeExecutableSchema({
	typeDefs,
	resolvers,
});
</div></code></pre>
</li>
</ol>
<h3 id="95-authentication--jwt-in-graphql">9.5 Authentication + JWT in GraphQL</h3>
<p>Authentication and authorization are crucial for securing GraphQL APIs. JSON Web Tokens (JWT) provide a stateless way to authenticate users and authorize access to resources.</p>
<h4 id="setting-up-jwt-authentication">Setting Up JWT Authentication</h4>
<ol>
<li>
<p><strong>Install Required Packages</strong></p>
<pre class="hljs"><code><div>npm install jsonwebtoken bcryptjs
</div></code></pre>
</li>
<li>
<p><strong>Create Authentication Utilities</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment">// utils/auth.js</span>
<span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsonwebtoken'</span>);
<span class="hljs-keyword">const</span> bcrypt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bcryptjs'</span>);

<span class="hljs-keyword">const</span> JWT_SECRET = process.env.JWT_SECRET || <span class="hljs-string">'your-secret-key'</span>;
<span class="hljs-keyword">const</span> JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || <span class="hljs-string">'7d'</span>;

<span class="hljs-comment">// Generate JWT token</span>
<span class="hljs-keyword">const</span> generateToken = <span class="hljs-function">(<span class="hljs-params">payload</span>) =&gt;</span> {
	<span class="hljs-keyword">return</span> jwt.sign(payload, JWT_SECRET, { <span class="hljs-attr">expiresIn</span>: JWT_EXPIRES_IN });
};

<span class="hljs-comment">// Verify JWT token</span>
<span class="hljs-keyword">const</span> verifyToken = <span class="hljs-function">(<span class="hljs-params">token</span>) =&gt;</span> {
	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">return</span> jwt.verify(token, JWT_SECRET);
	} <span class="hljs-keyword">catch</span> (error) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid or expired token'</span>);
	}
};

<span class="hljs-comment">// Hash password</span>
<span class="hljs-keyword">const</span> hashPassword = <span class="hljs-keyword">async</span> (password) =&gt; {
	<span class="hljs-keyword">const</span> saltRounds = <span class="hljs-number">10</span>;
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> bcrypt.hash(password, saltRounds);
};

<span class="hljs-comment">// Compare password</span>
<span class="hljs-keyword">const</span> comparePassword = <span class="hljs-keyword">async</span> (password, hashedPassword) =&gt; {
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> bcrypt.compare(password, hashedPassword);
};

<span class="hljs-built_in">module</span>.exports = {
	generateToken,
	verifyToken,
	hashPassword,
	comparePassword,
};
</div></code></pre>
</li>
<li>
<p><strong>Update User Model with Authentication</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment">// models/User.js</span>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> { hashPassword } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils/auth'</span>);

<span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> mongoose.Schema(
	{
		<span class="hljs-attr">username</span>: {
			<span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
			<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">trim</span>: <span class="hljs-literal">true</span>,
		},
		<span class="hljs-attr">email</span>: {
			<span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
			<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">lowercase</span>: <span class="hljs-literal">true</span>,
		},
		<span class="hljs-attr">password</span>: {
			<span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
			<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">minlength</span>: <span class="hljs-number">6</span>,
		},
		<span class="hljs-attr">role</span>: {
			<span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
			<span class="hljs-attr">enum</span>: [<span class="hljs-string">'USER'</span>, <span class="hljs-string">'ADMIN'</span>],
			<span class="hljs-attr">default</span>: <span class="hljs-string">'USER'</span>,
		},
	},
	{ <span class="hljs-attr">timestamps</span>: <span class="hljs-literal">true</span> }
);

<span class="hljs-comment">// Hash password before saving</span>
userSchema.pre(<span class="hljs-string">'save'</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">next</span>) </span>{
	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isModified(<span class="hljs-string">'password'</span>)) <span class="hljs-keyword">return</span> next();
	<span class="hljs-keyword">this</span>.password = <span class="hljs-keyword">await</span> hashPassword(<span class="hljs-keyword">this</span>.password);
	next();
});

<span class="hljs-built_in">module</span>.exports = mongoose.model(<span class="hljs-string">'User'</span>, userSchema);
</div></code></pre>
</li>
<li>
<p><strong>Create Authentication Context</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment">// context/auth.js</span>
<span class="hljs-keyword">const</span> { verifyToken } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils/auth'</span>);
<span class="hljs-keyword">const</span> User = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/User'</span>);

<span class="hljs-keyword">const</span> getUser = <span class="hljs-keyword">async</span> (req) =&gt; {
	<span class="hljs-keyword">const</span> token = req.headers.authorization?.replace(<span class="hljs-string">'Bearer '</span>, <span class="hljs-string">''</span>);

	<span class="hljs-keyword">if</span> (!token) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

	<span class="hljs-keyword">try</span> {
		<span class="hljs-keyword">const</span> decoded = verifyToken(token);
		<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findById(decoded.userId);
		<span class="hljs-keyword">return</span> user;
	} <span class="hljs-keyword">catch</span> (error) {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
	}
};

<span class="hljs-built_in">module</span>.exports = { getUser };
</div></code></pre>
</li>
<li>
<p><strong>Update GraphQL Schema with Authentication</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment">// schema/typeDefs.js</span>
<span class="hljs-keyword">const</span> { gql } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'apollo-server-express'</span>);

<span class="hljs-keyword">const</span> typeDefs = gql<span class="hljs-string">`
	type User {
		id: ID!
		username: String!
		email: String!
		role: Role!
		createdAt: String!
		updatedAt: String!
	}

	enum Role {
		USER
		ADMIN
	}

	type AuthPayload {
		token: String!
		user: User!
	}

	type Query {
		me: User
		users: [User!]! # Admin only
	}

	type Mutation {
		register(input: RegisterInput!): AuthPayload!
		login(input: LoginInput!): AuthPayload!
		updateProfile(input: UpdateProfileInput!): User!
	}

	input RegisterInput {
		username: String!
		email: String!
		password: String!
	}

	input LoginInput {
		email: String!
		password: String!
	}

	input UpdateProfileInput {
		username: String
		email: String
	}
`</span>;

<span class="hljs-built_in">module</span>.exports = typeDefs;
</div></code></pre>
</li>
<li>
<p><strong>Create Authentication Resolvers</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment">// resolvers/auth.js</span>
<span class="hljs-keyword">const</span> { GraphQLError } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'graphql'</span>);
<span class="hljs-keyword">const</span> User = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/User'</span>);
<span class="hljs-keyword">const</span> { generateToken, comparePassword } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils/auth'</span>);

<span class="hljs-keyword">const</span> authResolvers = {
	<span class="hljs-attr">Query</span>: {
		<span class="hljs-attr">me</span>: <span class="hljs-keyword">async</span> (parent, args, context) =&gt; {
			<span class="hljs-keyword">if</span> (!context.user) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(<span class="hljs-string">'You must be logged in'</span>, {
					<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'UNAUTHENTICATED'</span> },
				});
			}
			<span class="hljs-keyword">return</span> context.user;
		},

		<span class="hljs-attr">users</span>: <span class="hljs-keyword">async</span> (parent, args, context) =&gt; {
			<span class="hljs-comment">// Check if user is admin</span>
			<span class="hljs-keyword">if</span> (!context.user || context.user.role !== <span class="hljs-string">'ADMIN'</span>) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(<span class="hljs-string">'Access denied. Admin privileges required.'</span>, {
					<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'FORBIDDEN'</span> },
				});
			}
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> User.find();
		},
	},

	<span class="hljs-attr">Mutation</span>: {
		<span class="hljs-attr">register</span>: <span class="hljs-keyword">async</span> (parent, { input }) =&gt; {
			<span class="hljs-keyword">try</span> {
				<span class="hljs-comment">// Check if user already exists</span>
				<span class="hljs-keyword">const</span> existingUser = <span class="hljs-keyword">await</span> User.findOne({
					<span class="hljs-attr">$or</span>: [{ <span class="hljs-attr">email</span>: input.email }, { <span class="hljs-attr">username</span>: input.username }],
				});

				<span class="hljs-keyword">if</span> (existingUser) {
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(
						<span class="hljs-string">'User with this email or username already exists'</span>,
						{
							<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'BAD_USER_INPUT'</span> },
						}
					);
				}

				<span class="hljs-comment">// Create new user</span>
				<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> User(input);
				<span class="hljs-keyword">await</span> user.save();

				<span class="hljs-comment">// Generate token</span>
				<span class="hljs-keyword">const</span> token = generateToken({ <span class="hljs-attr">userId</span>: user.id });

				<span class="hljs-keyword">return</span> { token, user };
			} <span class="hljs-keyword">catch</span> (error) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(error.message, {
					<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'BAD_USER_INPUT'</span> },
				});
			}
		},

		<span class="hljs-attr">login</span>: <span class="hljs-keyword">async</span> (parent, { input }) =&gt; {
			<span class="hljs-keyword">try</span> {
				<span class="hljs-comment">// Find user by email</span>
				<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.findOne({ <span class="hljs-attr">email</span>: input.email });

				<span class="hljs-keyword">if</span> (!user) {
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(<span class="hljs-string">'Invalid email or password'</span>, {
						<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'UNAUTHENTICATED'</span> },
					});
				}

				<span class="hljs-comment">// Check password</span>
				<span class="hljs-keyword">const</span> isPasswordValid = <span class="hljs-keyword">await</span> comparePassword(
					input.password,
					user.password
				);

				<span class="hljs-keyword">if</span> (!isPasswordValid) {
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(<span class="hljs-string">'Invalid email or password'</span>, {
						<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'UNAUTHENTICATED'</span> },
					});
				}

				<span class="hljs-comment">// Generate token</span>
				<span class="hljs-keyword">const</span> token = generateToken({ <span class="hljs-attr">userId</span>: user.id });

				<span class="hljs-keyword">return</span> { token, user };
			} <span class="hljs-keyword">catch</span> (error) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(error.message, {
					<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'UNAUTHENTICATED'</span> },
				});
			}
		},

		<span class="hljs-attr">updateProfile</span>: <span class="hljs-keyword">async</span> (parent, { input }, context) =&gt; {
			<span class="hljs-keyword">if</span> (!context.user) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(<span class="hljs-string">'You must be logged in'</span>, {
					<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'UNAUTHENTICATED'</span> },
				});
			}

			<span class="hljs-keyword">try</span> {
				<span class="hljs-keyword">const</span> updatedUser = <span class="hljs-keyword">await</span> User.findByIdAndUpdate(
					context.user.id,
					input,
					{ <span class="hljs-attr">new</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">runValidators</span>: <span class="hljs-literal">true</span> }
				);

				<span class="hljs-keyword">return</span> updatedUser;
			} <span class="hljs-keyword">catch</span> (error) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(<span class="hljs-string">'Failed to update profile'</span>, {
					<span class="hljs-attr">extensions</span>: { <span class="hljs-attr">code</span>: <span class="hljs-string">'BAD_USER_INPUT'</span> },
				});
			}
		},
	},
};

<span class="hljs-built_in">module</span>.exports = authResolvers;
</div></code></pre>
</li>
<li>
<p><strong>Update Server with Authentication Context</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment">// server.js</span>
<span class="hljs-keyword">const</span> { ApolloServer } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'apollo-server-express'</span>);
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> typeDefs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./schema/typeDefs'</span>);
<span class="hljs-keyword">const</span> resolvers = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./resolvers'</span>);
<span class="hljs-keyword">const</span> { getUser } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./context/auth'</span>);

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startServer</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">const</span> app = express();

	<span class="hljs-comment">// Connect to MongoDB</span>
	<span class="hljs-keyword">await</span> mongoose.connect(<span class="hljs-string">'mongodb://localhost:27017/graphql-auth'</span>);

	<span class="hljs-comment">// Create Apollo Server</span>
	<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> ApolloServer({
		typeDefs,
		resolvers,
		<span class="hljs-attr">context</span>: <span class="hljs-keyword">async</span> ({ req }) =&gt; {
			<span class="hljs-comment">// Get user from token</span>
			<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> getUser(req);
			<span class="hljs-keyword">return</span> { user };
		},
	});

	<span class="hljs-keyword">await</span> server.start();
	server.applyMiddleware({ app });

	<span class="hljs-keyword">const</span> PORT = process.env.PORT || <span class="hljs-number">4000</span>;
	app.listen(PORT, () =&gt; {
		<span class="hljs-built_in">console</span>.log(
			<span class="hljs-string">`Server running on http://localhost:<span class="hljs-subst">${PORT}</span><span class="hljs-subst">${server.graphqlPath}</span>`</span>
		);
	});
}

startServer().catch(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
	<span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Error starting server:'</span>, error);
});
</div></code></pre>
</li>
</ol>
<h4 id="testing-authentication">Testing Authentication</h4>
<ol>
<li>
<p><strong>Register a New User</strong></p>
<pre class="hljs"><code><div>mutation {
	register(
		input: {
			username: &quot;johndoe&quot;
			email: &quot;john@example.com&quot;
			password: &quot;password123&quot;
		}
	) {
		token
		user {
			id
			username
			email
			role
		}
	}
}
</div></code></pre>
</li>
<li>
<p><strong>Login</strong></p>
<pre class="hljs"><code><div>mutation {
	login(input: { email: &quot;john@example.com&quot;, password: &quot;password123&quot; }) {
		token
		user {
			id
			username
			email
		}
	}
}
</div></code></pre>
</li>
<li>
<p><strong>Access Protected Resources</strong></p>
<p>Add the JWT token to your request headers:</p>
<pre class="hljs"><code><div>{
    &quot;Authorization&quot;: &quot;Bearer your-jwt-token-here&quot;
}
</div></code></pre>
<p>Then query protected resources:</p>
<pre class="hljs"><code><div>query {
	me {
		id
		username
		email
		role
	}
}
</div></code></pre>
</li>
</ol>
<h4 id="best-practices-for-graphql-authentication">Best Practices for GraphQL Authentication</h4>
<ol>
<li><strong>Use HTTPS</strong>: Always use HTTPS in production to protect tokens in transit</li>
<li><strong>Token Expiration</strong>: Set appropriate token expiration times</li>
<li><strong>Refresh Tokens</strong>: Implement refresh tokens for better security</li>
<li><strong>Rate Limiting</strong>: Implement rate limiting to prevent brute force attacks</li>
<li><strong>Input Validation</strong>: Always validate and sanitize user inputs</li>
<li><strong>Error Handling</strong>: Don't expose sensitive information in error messages</li>
</ol>
<h4 id="authorization-patterns">Authorization Patterns</h4>
<ol>
<li>
<p><strong>Field-Level Authorization</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> resolvers = {
	<span class="hljs-attr">User</span>: {
		<span class="hljs-attr">email</span>: <span class="hljs-function">(<span class="hljs-params">user, args, context</span>) =&gt;</span> {
			<span class="hljs-comment">// Only allow users to see their own email or admins to see all emails</span>
			<span class="hljs-keyword">if</span> (context.user.id === user.id || context.user.role === <span class="hljs-string">'ADMIN'</span>) {
				<span class="hljs-keyword">return</span> user.email;
			}
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(<span class="hljs-string">'Access denied'</span>);
		},
	},
};
</div></code></pre>
</li>
<li>
<p><strong>Directive-Based Authorization</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">const</span> {
	mapSchema,
	getDirective,
	MapperKind,
} = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@graphql-tools/utils'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authDirectiveTransformer</span>(<span class="hljs-params">schema, directiveName</span>) </span>{
	<span class="hljs-keyword">return</span> mapSchema(schema, {
		[MapperKind.FIELD]: <span class="hljs-function">(<span class="hljs-params">fieldConfig, _fieldName, typeName</span>) =&gt;</span> {
			<span class="hljs-keyword">const</span> authDirective = getDirective(
				schema,
				fieldConfig,
				directiveName
			)?.[<span class="hljs-number">0</span>];
			<span class="hljs-keyword">if</span> (authDirective) {
				<span class="hljs-keyword">const</span> { requires } = authDirective;
				<span class="hljs-keyword">const</span> { resolve = defaultFieldResolver } = fieldConfig;

				fieldConfig.resolve = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">source, args, context, info</span>) </span>{
					<span class="hljs-keyword">if</span> (!context.user || context.user.role !== requires) {
						<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> GraphQLError(<span class="hljs-string">'Access denied'</span>);
					}
					<span class="hljs-keyword">return</span> resolve(source, args, context, info);
				};
			}
			<span class="hljs-keyword">return</span> fieldConfig;
		},
	});
}
</div></code></pre>
</li>
</ol>
<p>This completes the comprehensive Node.js notes covering all topics from beginner to advanced levels, including the integration of GraphQL with authentication and JWT implementation. The notes now provide a complete learning path for mastering Node.js development!</p>
<hr>
<p><em>These Notes Were Compiled By Deepak Modi</em></p>
<p><em>Website: <a href="https://deepakmodi.tech">Deepak Modi</a></em></p>
<p><em>Connect with me on <a href="https://www.linkedin.com/in/deepakmodi1/">LinkedIn</a> for more updates and resources!</em></p>

</body>
</html>
